!function(n){var e=false||document.getElementById("newBridge");!function(n){function e(n,e){return N(n,e)}function t(n,e,t){if(null==t&&(null==e?(t=n,n=null):(t=e,e=null,n instanceof Array&&(e=n,n=null))),null!=t){var r=window.opera;if(!n&&document.attachEvent&&(!r||"[object Opera]"!==r.toString())){var a=S();n=a&&a.getAttribute("data-require-id")}n?(i(n,e,t),P&&clearTimeout(P)):C[0]={deps:e,factory:t}}}function r(){var n=H.config[this.id];return n&&"object"==typeof n?n:{}}function i(n,e,t){O[n]||(O[n]={id:n,depsDec:e,deps:e||["require","exports","module"],factoryDeps:[],factory:t,exports:{},config:r,state:j,require:M(n),depMs:[],depMkv:{},depRs:[],depPMs:[]})}function a(n){var e=O[n];if(e&&!f(n,F)){var t=e.deps,r=e.factory,i=0;"function"==typeof r&&(i=Math.min(r.length,t.length),!e.depsDec&&r.toString().replace(/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,"").replace(/require\(\s*(['"'])([^'"]+)\1\s*\)/g,function(n,e,r){t.push(r)}));var a=[];$(t,function(t,r){var o,u,c=A(t),f=E(c.mod,n);f&&!L[f]?(c.res&&(u={id:t,mod:f,res:c.res},D[f]=1,e.depPMs.push(f),e.depRs.push(u)),(o=e.depMkv[f])||(o={id:c.mod,absId:f,hard:i>r},e.depMs.push(o),e.depMkv[f]=o,a.push(f))):o={absId:f},i>r&&e.factoryDeps.push(u||o)}),e.state=F,c(n),g(a)}}function o(){for(var n in D)u(n),s(n)}function u(n){function e(n){if(!f(n,F))return!1;if(f(n,T)||t[n])return!0;t[n]=1;var r=O[n],i=!0;return $(r.depMs,function(n){return i=e(n.absId)}),i&&$(r.depRs,function(n){return i=!(!n.absId||!f(n.absId,z))}),i&&(r.state=T),i}var t={};e(n)}function c(e){function t(){if(!r&&i.state===T){r=1;var t=1,a=[];if($(i.factoryDeps,function(n){var e=n.absId;return L[e]||(s(e),f(e,z))?void a.push(e):(t=0,!1)}),t){try{var o=l(a,{require:i.require,exports:i.exports,module:i}),u=i.factory,c="function"==typeof u?u.apply(n,o):u;null!=c&&(i.exports=c),i.invokeFactory=null,delete D[e]}catch(n){if(r=0,/^\[MODULE_MISS\]"([^"]+)/.test(n.message)){var d=i.depMkv[RegExp.$1];return void(d&&(d.hard=1))}throw n}p(e)}}}var r,i=O[e];i.invokeFactory=t,$(i.depPMs,function(n){d(n,function(){$(i.depRs,function(t){t.absId||t.mod!==n||(t.absId=E(t.id,e),g([t.absId],o))})})})}function f(n,e){return O[n]&&O[n].state>=e}function s(n){var e=O[n];e&&e.invokeFactory&&e.invokeFactory()}function l(n,e){var t=[];return $(n,function(n,r){t[r]=e[n]||v(n)}),t}function d(n,e){if(f(n,z))return void e();var t=_[n];t||(t=_[n]=[]),t.push(e)}function p(n){var e=_[n]||[];O[n].state=z;for(var t=e.length;t--;)e[t]();e.length=0,delete _[n]}function v(n){return f(n,z)?O[n].exports:null}function m(n){$(C,function(e){i(n,e.deps,e.factory)}),C.length=0,a(n)}function g(e,t,r,i){function u(){if(!c){var r=1;$(e,function(n){return L[n]?void 0:r=!!f(n,z)}),r&&(c=1,"function"==typeof t&&t.apply(n,l(e,L)))}}if("string"==typeof e){if(s(e),!f(e,z))throw new Error('[MODULE_MISS]"'+e+'" is not exists!');return v(e)}i=i||{};var c=0;e instanceof Array&&(u(),c||($(e,function(n){L[n]||f(n,z)||(d(n,u),i[n]||(n.indexOf("!")>0?h:y)(n,r),a(n))}),o()))}function y(n){function e(){var e=t.readyState;if(void 0===e||/^(loaded|complete)$/.test(e)){t.onload=t.onreadystatechange=null,t=null,m(n);for(var r in D)a(r);o()}}if(!G[n]&&!O[n]){G[n]=1;var t=document.createElement("script");t.setAttribute("charset","utf-8"),t.setAttribute("data-require-id",n),t.src=q(n+".js"),t.async=!0,t.readyState?t.onreadystatechange=e:t.onload=e,R(t)}}function h(n,e){function t(e){o.exports=e||!0,p(n)}function i(i){var o=e?O[e].require:N;i.load(a.res,o,t,r.call({id:n}))}if(!O[n]){var a=A(n),o={id:n,state:F};O[n]=o,t.fromText=function(n,e){D[n]=1,new Function(e)(),m(n)},i(v(a.mod))}}function b(n,e){var t=I(n,1,e);return t.sort(B),t}function x(){H.baseUrl=H.baseUrl.replace(/\/$/,"")+"/",J=b(H.paths),Q=b(H.map,1),$(Q,function(n){n.v=b(n.v)}),K=[],$(H.packages,function(n){var e=n;"string"==typeof n&&(e={name:n.split("/")[0],location:n,main:"main"}),e.location=e.location||e.name,e.main=(e.main||"main").replace(/\.js$/i,""),e.reg=U(e.name),K.push(e)}),K.sort(B),V=b(H.urlArgs,1),W=b(H.noRequests),$(W,function(n){var e=n.v,t={};n.v=t,e instanceof Array||(e=[e]),$(e,function(n){t[n]=1})})}function k(n,e,t){$(e,function(e){return e.reg.test(n)?(t(e.v,e.k,e),!1):void 0})}function q(n){var e=/(\.[a-z0-9]+)$/i,t=/(\?[^#]*)$/,r="",i=n,a="";t.test(n)&&(a=RegExp.$1,n=n.replace(t,"")),e.test(n)&&(r=RegExp.$1,i=n.replace(e,""));var o,u=i;return k(i,J,function(n,e){u=u.replace(e,n),o=1}),o||k(i,K,function(n,e,t){u=u.replace(t.name,t.location)}),/^([a-z]{2,10}:\/)?\//i.test(u)||(u=H.baseUrl+u),u+=r+a,k(i,V,function(n){u+=(u.indexOf("?")>0?"&":"?")+n}),u}function M(n){function e(e,r){if("string"==typeof e)return t[e]||(t[e]=g(E(e,n))),t[e];if(e instanceof Array){var i=[],a=[],o=[];$(e,function(e,t){var r=A(e),u=E(r.mod,n);a.push(u),D[u]=1,r.res?(i.push(u),o[t]=null):o[t]=u});var u={};$(a,function(n){var e;k(n,W,function(n){e=n}),e&&(e["*"]?u[n]=1:$(a,function(t){return e[t]?(u[n]=1,!1):void 0}))}),g(a,function(){$(o,function(t,r){null==t&&(o[r]=E(e[r],n))}),g(o,r,n)},n,u)}}var t={};return e.toUrl=function(e){return q(E(e,n))},e}function E(n,e){if(!n)return"";e=e||"";var t=A(n);if(!t)return n;var r=t.res,i=w(t.mod,e);if($(K,function(n){var e=n.name;return e===i?(i=e+"/"+n.main,!1):void 0}),k(e,Q,function(n){k(i,n,function(n,e){i=i.replace(e,n)})}),r){var a=v(i);r=a.normalize?a.normalize(r,function(n){return E(n,e)}):E(r,e),i+="!"+r}return i}function w(n,e){if(0===n.indexOf(".")){var t=e.split("/"),r=n.split("/"),i=t.length-1,a=r.length,o=0,u=0;n:for(var c=0;a>c;c++){var f=r[c];switch(f){case"..":if(!(i>o))break n;o++,u++;break;case".":u++;break;default:break n}}return t.length=i-o,r=r.slice(u),t.concat(r).join("/")}return n}function A(n){var e=n.split("!");return e[0]?{mod:e[0],res:e[1]}:null}function I(n,e,t){var r=[];for(var i in n)if(n.hasOwnProperty(i)){var a={k:i,v:n[i]};r.push(a),e&&(a.reg="*"===i&&t?/^/:U(i))}return r}function S(){if(X)return X;if(Y&&"interactive"===Y.readyState)return Y;for(var n=document.getElementsByTagName("script"),e=n.length;e--;){var t=n[e];if("interactive"===t.readyState)return Y=t,t}}function R(n){X=n,nn?Z.insertBefore(n,nn):Z.appendChild(n),X=null}function U(n){return new RegExp("^"+n+"(/|$)")}function $(n,e){if(n instanceof Array)for(var t=0,r=n.length;r>t&&!1!==e(n[t],t);t++);}function B(n,e){var t=n.k||n.name,r=e.k||e.name;return"*"===r?-1:"*"===t?1:r.length-t.length}var O={},D={},j=1,F=2,T=3,z=4,N=M();e.version="1.8.6",e.loader="esl",e.toUrl=N.toUrl;var P;t.amd={};var _={},L={require:e,exports:1,module:1},C=[],G={},H={baseUrl:"./",paths:{},config:{},map:{},packages:[],noRequests:{},urlArgs:{}};e.config=function(n){function e(n){i.push(n)}if(n){for(var t in H){var r=n[t],i=H[t];if(r)if("urlArgs"===t&&"string"==typeof r)H.urlArgs["*"]=r;else if(i instanceof Array)$(r,e);else if("object"==typeof i)for(var t in r)i[t]=r[t];else H[t]=r}x()}},x();var J,K,Q,V,W,X,Y,Z=document.getElementsByTagName("head")[0],nn=document.getElementsByTagName("base")[0];nn&&(Z=nn.parentNode),n.define||(n.define=t,n.require||(n.require=e),n.esl=e)}(e);var require=e.require,define=e.define;require.config({ 'baseUrl': '//sgoutong.baidu.com/embed/1560519811/asset', 'paths': { 'cl': 'common/css' }, 'packages': [ { 'name': 'bull', 'location': '../dep/bull/asset', 'main': 'main' }, { 'name': 'im-lib', 'location': '../dep/im-lib/0.1.0/asset/pc', 'main': 'main' }, { 'name': 'im-core', 'location': '../dep/im-core/0.2.0/asset', 'main': 'main' }, { 'name': 'im-filter', 'location': '../dep/im-filter/0.1.0/asset', 'main': 'main' }, { 'name': 'qiao-im-msdk', 'location': '../dep/im-core/0.2.0/asset', 'main': 'proxy' } ] }),define("bull/aop/JointPoint",["require"],function(require){function e(e,t,i,n,o,r){this.thisp=e,this.args=t,this.modName=i,this.funcName=n,this.func=o,this.returnValue=r}return e.prototype={constructor:e,getThis:function(){return this.thisp},getArgs:function(){return this.args},getModName:function(){return this.modName},getFuncName:function(){return this.funcName},getFunc:function(){return this.func},setReturnValue:function(e){this.returnValue=e},getReturnValue:function(){return this.returnValue}},e}),define("bull/aop/aopEmitter",["require","./main"],function(require){function e(e,i,n){var o=[],r=t;if(r=r[e]||{},r=r[i]||{},r=r[n]||[],"[object Array]"==={}.toString.call(r))for(var a=0;a<r.length;a++)o.push(r[a]);return o}var exports={},t={};return exports.on=function(e,i,n,o){var r=t;r[e]=r[e]||{},r=r[e],r[i]=r[i]||{},r=r[i],r[n]=r[n]||[],r=r[n],r.push({func:o.func,funcName:o.funcName,modName:o.modName})},exports.getBefore=function(t,i){return e(require("./main").TypeEnum.BEFORE,t,i)},exports.queryBefore=function(e,t){var i=exports.getBefore();if(console.log("method before "+e+" -> "+t+":"),!i.length)return void console.log("none");for(var n=0;n<i.length;n++)console.log(i[n].modName+" -> "+i[n].funcName);console.log("-----------------------------------")},exports.getAfter=function(t,i){return e(require("./main").TypeEnum.AFTER,t,i)},exports.queryAfter=function(e,t){var i=exports.getAfter();if(!i.length)return void console.log("none");console.log("method after "+e+" -> "+t+":");for(var n=0;n<i.length;n++)console.log(i[n].modName+" -> "+i[n].funcName);console.log("-----------------------------------")},exports.getRegisterAop=function(e){var i={},n=[],o=t[e];for(var r in o)if(o.hasOwnProperty(r)){var a=o[r];for(var s in a)if(a.hasOwnProperty(s)){if(!i[s])i[s]=!0,n.push({modName:r,funcName:s,from:a[s][0].modName})}}return n},exports.emit=function(t,i,n,o){for(var r=e(t,i,n),a=0;a<r.length;a++)r[a].func(o)},exports}),define("bull/microPromise/microPromise",["require"],function(require){function e(){for(var e=arguments.length,i=0,n=t(),o=[],r=0;r<e;r++){var a=arguments[r];!function(t){a.then(function(r){if(i++,o[t]=r,i===e)n.resolve.apply(n,o)},function(){n.reject()})}(r)}return n.promise()}var t=function(){function e(){for(var e=this,t=0;t<o.length;t++)!function(t){if(a&&a[0]&&a[0].then)a[0].then(function(){o[t].apply(e,arguments)});else setTimeout(function(){o[t].apply(e,a)},0)}(t)}function i(){for(var e=this,t=0;t<r.length;t++)!function(t){setTimeout(function(){r[t].apply(e,a)},0)}(t)}function n(e,i){var n=t();if(u===c.resolved){var l=this;setTimeout(function(){e.apply(l,a)},0)}else if(u===c.reject){var l=this;setTimeout(function(){i.call(l,s)},0)}else{if(e)o.push(function(){n.resolve(e.apply(l,arguments))});if(i)r.push(function(e){i(e),n.reject()})}return n.promise()}if(!this instanceof t)return new t;var o=[],r=[],a=[],s="",c={pendding:1,resolved:2,rejected:3},u=c.pendding;return{resolve:function(){var t=Array.prototype.slice.call(arguments,0);if(u===c.pendding)a=t,u=c.resolved,e.call(this)},reject:function(e){if(u===c.pendding)s=e,u=c.rejected,i.call(this)},then:n,promise:function(){return{then:n}}}};return{Deferred:t,when:e}}),define("bull/aop/main",["require","./JointPoint","./aopEmitter","../loader","../microPromise/microPromise"],function(require){function e(e,t,i){r.emit(a.BEFORE,e,t,i)}function t(e,t,i){r.emit(a.AFTER,e,t,i)}function i(e){return e=e||"",e.replace(/^\s|\s$/g,"")}function n(e){e=e||"";var t=e.split(","),n=i(t[0]||""),o=i(t[1]),r=i(t[2]);return t=n.split("."),{packageName:t[0],modName:t[1],funcName:t[2],before:o,after:r}}var exports={},o=require("./JointPoint"),r=require("./aopEmitter"),a=exports.TypeEnum={BEFORE:"type1",AFTER:"type2"};return exports.createAopProxy=function(i,n,r){var a=require("../loader"),s=require("../microPromise/microPromise");return function(){var c=[],u=Array.prototype.slice.call(arguments,0),l=new o(this,u,i,n,r),f={jointPoint:l,microPromise:s};e(i,n,l);var d=a.getInjection(i)||{},m=d[n]||[];if("[object Array]"==={}.toString.call(m))for(var g=0;g<m.length;g++){var p=m[g];if(p in f)c.push(f[p]);else c.push(a.get(p))}c=c.concat(u);var h=r.apply(this,c);if(h&&h.then)h.then(function(e){l.setReturnValue(e),t(i,n,l)});else l.setReturnValue(h),t(i,n,l);return h}},exports.aspectRegister=function(e,t,i){var o=require("../loader");if(-1===e.indexOf("."))e=t+"."+e;for(var s=0;s<i.length;s++)!function(t){t.before&&r.on(a.BEFORE,t.packageName+"."+t.modName,t.funcName,{modName:e,funcName:t.before,func:function(i){var n=o.get(e)[t.before];if(!n)throw'module "'+e+"\" don't have method "+t.before;n.apply(i.getThis(),i.getArgs())}}),t.after&&r.on(a.AFTER,t.packageName+"."+t.modName,t.funcName,{modName:e,funcName:t.after,func:function(i){var n=o.get(e)[t.after];if(!n)throw'module "'+e+"\" don't have method "+t.after;n.apply(i.getThis(),i.getArgs())}})}(n(i[s]))},exports}),define("bull/loader",["require","./aop/main"],function(require){function e(t,i){var n;if("function"==typeof i){e(t,i.prototype);var o=c(t,r,i);return o.prototype=i.prototype,o}else{for(var r in i)if(i.hasOwnProperty(r))if("function"==typeof(n=i[r]))i[r]=c(t,r,n);return i}}function t(e){e=e||[];for(var t=0;t<e.length;t++)exports.init(e[t])}function i(t,i){for(var n in t)if(t.hasOwnProperty(n)){var o=t[n];if(n=i+"."+n,r.hasOwnProperty(n)){if(o._belong&&n!==o._belong)throw'module conflict: module "'+n+'" is already register to "'+o._belong+'"'}else{if(o._belong)throw'module "'+n+'" already register to "'+o._belong+'"';o._belong=n,r[n]=e(n,o)}}}function n(e,t){e=e||[];for(var i=0;i<e.length;i++){var n=e[i];a[n.id]=a[n.id]||{};var o=a[n.id],r=n.method;for(var s in r)o[s]=r[s]}}function o(e,t){for(var i=0;i<e.length;i++){var n=e[i];u(n.id,t,n.pointCut)}}var exports={},r={},a={},s=require("./aop/main"),c=s.createAopProxy,u=s.aspectRegister;return exports.init=function(e){if(!e._initialized){e._initialized=!0;var r=e.package;if(!r&&(e.resource||e.aspect))throw"package name not found";t(e.importConfig),e.resource&&i(e.resource,r),e.aspect&&o(e.aspect,r),e.injection&&n(e.injection,r)}},exports.getInjection=function(e){return a[e]},exports.getDeps=function(e){var t=a[e],i={};for(var n in t)if(t.hasOwnProperty(n))for(var o=t[n],r=0;r<o.length;r++)i[o[r]]=!0;delete i[e];var s=[];for(var n in i)if(n.indexOf(".")>-1)s.push(n);return s},exports.queryDep=function(e){var t=exports.getDeps(e);if(console.log("deps of "+e+" is:"),!t.length)console.log("none");for(var i=0;i<t.length;i++)console.log(t[i]);console.log("-----------------------------------")},exports.getModules=function(e){e=e||"";var t=[];for(var i in r)if(r.hasOwnProperty(i))if(e){if(i.indexOf(e)>-1)t.push(i)}else t.push(i);return t},exports.queryModule=function(e){var t=exports.getModules(e);if(e)console.log('modules contains "'+e+'":');else console.log("all modules:");for(var i=0;i<t.length;i++)console.log(t[i]);console.log("-----------------------------------")},exports.queryInvoke=function(e){var t=[],i={};for(var n in a)if(a.hasOwnProperty(n)){var o=a[n];for(var r in o)if(o.hasOwnProperty(r))for(var s=o[r],c=0;c<s.length;c++){var u=s[c];if(u===e){var l=n+u;if(l in i)continue;else i[l]=!0;t.push({modName:n,funcName:r})}}}if(t.length){console.log("module "+e+" used by these method:");for(var c=0;c<t.length;c++)console.log(t[c].modName+" -> "+r)}else console.log("module"+e+" used nowhere");console.log("-----------------------------------")},exports.checkDep=function(){var e,t=0;console.log("checking deps:");for(var i in r)if(r.hasOwnProperty(i)){e=exports.getDeps(i);for(var n=0;n<e.length;n++)if(!exports.has(e[n]))if(e[n].indexOf(".")>-1)t++,console.log(e[n]+" is required by "+i+" but now missing")}if(!t)console.log("all dependencies is ready");console.log("-----------------------------------")},exports.has=function(e){return e in r},exports.get=function(e){if(e in r)return r[e];else throw'module "'+e+'" not found'},exports}),define("bull/main",["require","./loader","./aop/aopEmitter"],function(require){function e(){var e=document.createElement("div"),t=e.style;t.position="fixed",t.right="20px",t.top="20px",t.border="solid 1px black",t.backgroundColor="#eee",e.innerHTML="\u70b9\u6b64\u67e5\u770b<br/>\u6a21\u5757\u5173\u7cfb";var i=!1;e.onclick=function(){if(!i)i=!0,require(["bull/debug"],function(e){i=!1,e.entry()})},document.body.insertBefore(e,document.body.firstChild)}function t(){if(location.hash.indexOf("bullDebug")>-1)e()}var exports={},i=require("./loader"),n=require("./aop/aopEmitter");return exports.get=i.get,exports.queryBefore=n.queryBefore,exports.queryAfter=n.queryAfter,exports.queryInvoke=i.queryInvoke,exports.queryDep=i.queryDep,exports.checkDep=i.checkDep,exports.queryModule=i.queryModule,exports.init=function(e){t(),i.init(e)},exports}),define("bull",["bull/main"],function(e){return e}),define("im-lib/lang/isObject",[],function(){return function(e){return"[object Object]"==Object.prototype.toString.call(e)}}),define("im-lib/lang/isArray",[],function(){return function(e){return"[object Array]"==Object.prototype.toString.call(e)}}),define("im-lib/lang/extend",[],function(){return function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}}),define("im-lib/lang/each",["require","./isArray"],function(require){return function(e,t,i){if(require("./isArray")(e)){for(var n=e.length,o=0;o<n;o++)if("function"==typeof t)t.call(i,e[o],o,e)}else for(var r in e)if(e.hasOwnProperty(r))t.call(i,r,e[r],e)}}),define("im-lib/lang",["require","./lang/isObject","./lang/isArray","./lang/extend","./lang/each"],function(require){var exports={};return exports.isObject=require("./lang/isObject"),exports.isArray=require("./lang/isArray"),exports.extend=require("./lang/extend"),exports.each=require("./lang/each"),exports}),define("im-lib/json",[],function(){function e(e){if(/["\\\x00-\x1f]/.test(e))e=e.replace(/["\\\x00-\x1f]/g,function(e){var t=r[e];if(t)return t;else return t=e.charCodeAt(),"\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16)});return'"'+e+'"'}function t(e){var t,i,n,r=["["],a=e.length;for(i=0;i<a;i++)switch(typeof(n=e[i])){case"undefined":case"function":case"unknown":break;default:if(t)r.push(",");r.push(o(n)),t=1}return r.push("]"),r.join("")}function i(e){return e<10?"0"+e:e}function n(e){return'"'+e.getFullYear()+"-"+i(e.getMonth()+1)+"-"+i(e.getDate())+"T"+i(e.getHours())+":"+i(e.getMinutes())+":"+i(e.getSeconds())+'"'}function o(i){switch(typeof i){case"undefined":return"undefined";case"number":return isFinite(i)?String(i):"null";case"string":return e(i);case"boolean":return String(i);default:if(null===i)return"null";else if(i instanceof Array)return t(i);else if(i instanceof Date)return n(i);else{var r,a,s=["{"],c=o;for(var u in i)if(Object.prototype.hasOwnProperty.call(i,u))switch(typeof(a=i[u])){case"undefined":case"unknown":case"function":break;default:if(r)s.push(",");r=1,s.push(c(u)+":"+c(a))}return s.push("}"),s.join("")}}}var exports={};exports.parse=function(e){if(window.JSON&&JSON.parse)return JSON.parse(e);else return new Function("return ("+e+")")()},exports.stringify=function(e){if(window.JSON&&JSON.stringify)return JSON.stringify(e);else return o(e)};var r={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return exports}),define("im-lib/net",[],function(){function e(){if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}if(window.XMLHttpRequest)return new XMLHttpRequest}var exports={};return exports.imgRequest=function(e){document.createElement("img").src=e},exports.jsonp=function(e,t){function i(){return(new Date).getTime()}function n(){return Math.random().toString().substr(2)}function o(e){if(e){var t=e.parentNode;if(t&&11!==t.nodeType)t.removeChild(e)}}function r(e){var t="";if("string"==typeof e)t=e;else if("object"==typeof e)for(var n in e)if(e.hasOwnProperty(n))t+="&"+n+"="+encodeURIComponent(e[n]);return t+="&_time="+i(),t=t.substr(1)}function a(e,a,s,c){var u,l=(a.op,a.l);a=null,e=e+(-1===e.indexOf("?")?"?":"&")+r(a);var f=/callback=(\w+)/.exec(e);if(f&&f[1])u=f[1];else u="jsonp_bridge_"+i()+"_"+n(),e=e.replace("?","?"+t.key+"="+u+"&");var d=document.createElement("script");d.type="text/javascript",d.src=e,d.id="id_"+u,d.charset="utf-8";var m=!0,g=null;if(window[u]=function(e){clearTimeout(g),window[u]=void 0;var t=document.getElementById("id_"+u);setTimeout(function(){o(t)},0),s(e),m=!1},"onerror"in d)d.onerror=function(){c&&c(),o(d)},m=!1;var p=1e4;if(1===l)p+=2e4;g=setTimeout(function(){if(m)c&&c(),o(d)},p);var h=document.getElementsByTagName("head")[0];if(h)setTimeout(function(){h.appendChild(d)},0)}a(e,t,t.success,t.failure)},exports.request=function(t,i){var n=e(),o=3e4,r=setTimeout(function(){n.onreadystatechange=null,n.abort(),i.failure&&i.failure()},o);return n.open(i.method||"GET",t),n.onreadystatechange=function(){if(4===n.readyState)if(clearTimeout(r),n.status>=200&&n.status<300||304===n.status){if(i.success)i.success(n.responseText)}else if(i.failure)i.failure()},n.send(i.data),n},exports.upload=function(e,t,i,n,o){function r(){n(),f.onload=function(){},f.parentNode.removeChild(f)}function a(){o(),f.onerror=function(){},f.parentNode.removeChild(f)}if("/"===e.charAt(0)&&!/^\/\//.test(e))e=location.protocol+"//"+location.host+e;if("[object String]"===Object.prototype.toString.call(t)&&window.clouda){var s=t;clouda.device.fs.post(s,e,{onsuccess:function(e){if(n)n(e)},onfail:function(){if(o)o()},uploadKey:i,param:{}})}else if(t.nodeName){var c="upload_iframe"+parseInt(1e4*Math.random(),10),u='<iframe id="'+c+'" name="'+c+'" width="0" height="0" border="0" style="width: 0; height: 0; border: none;">',l=document.createElement("div");l.innerHTML=u;var f=l.getElementsByTagName("iframe")[0];if(document.body.appendChild(f),t.setAttribute("target",c),t.setAttribute("action",e),t.setAttribute("method","post"),t.setAttribute("enctype","multipart/form-data"),t.setAttribute("encoding","multipart/form-data"),f.attachEvent)f.attachEvent("onload",r),f.attachEvent("onerror",a);else f.onload=r,f.onerror=a;t.submit()}else if(window.FormData){var d=new FormData;d.append(i,t),exports.request(e,{success:n,failure:o,data:d,method:"post"})}},exports.initWs=function(e,t,i){e.init(t,i)},exports.ws=function(e,t,i,n){e.sendMsg(t,i,n)},exports}),define("im-lib/util",[],function(){var exports={},e="0123456789ABCDEF";return exports.uuid=function(){for(var t=[],i=0;i<32;i++)t[i]=e.substr(Math.floor(16*Math.random()),1);t[12]="4",t[16]=e.substr(3&t[16]|8,1);var n=t.join("").toLowerCase();return n=n.toLowerCase(),n=n.replace(/^(\w{8})(\w{4})(\w{4})(\w{4})(\w{12})$/,"$1-$2-$3-$4-$5")},exports.decodeHTML=function(e){return e=e||"",e.replace("&lt;","<").replace("&gt;",">").replace("&amp;","&").replace("&quot;",'"').replace("&nbsp;"," ")},exports.encodeHTML=function(e){return e=e||"",e.replace(/</g,"&lt").replace(/>/g,"&gt").replace(/&/g,"&amp").replace(/"/g,"&quot").replace(/ /g,"&nbsp")},exports.getText=function(e){var t="";if(3===e.nodeType||4===e.nodeType)t+=exports.decodeHTML(e.nodeValue);else if("IMG"===e.tagName)if(e.getAttribute("data-face-id"))return"["+e.getAttribute("data-face-text")+"]";else return"[\u56fe\u7247]";else if(8!==e.nodeType)for(var i=0;i<e.childNodes.length;i++)t+=exports.getText(e.childNodes[i]);return t},exports.isSupportWs=function(){return"function"==typeof window.WebSocket&&"function"==typeof window.WebSocket.prototype.send}(),exports.padLeft=function(e,t,i){i=i||"0";for(var n=e.toString().length;n<t;)e=i+e,n++;return e},exports.msgid=function(){for(var e=[],t=0;t<5;t++)e[t]=Math.floor(10*Math.random());return(new Date).getTime()+e.join("")},exports.getCookie=function(e,t){var i=e+"=",n="";if(document.cookie.length>0){var o=document.cookie.indexOf(i);if(o>-1){o+=i.length;var r=document.cookie.indexOf(";",o);if(-1===r)r=document.cookie.length;n=t?unescape(document.cookie.substring(o,r)):document.cookie.substring(o,r)}}return n},exports}),define("im-lib/Emitter",[],function(){function e(){}var t=e.prototype;return t._getEvents=function(){if(!this._events)this._events={};return this._events},t._getMaxListeners=function(){if(isNaN(this.maxListeners))this.maxListeners=10;return this.maxListeners},t.on=function(e,t){var i=this._getEvents(),n=this._getMaxListeners();i[e]=i[e]||[];var o=i[e].length;if(o>=n&&0!==n)throw new RangeError("Warning: possible Emitter memory leak detected. "+o+" listeners added.");return i[e].push(t),this},t.once=function(e,t){function i(){n.off(e,i),t.apply(this,arguments)}var n=this;return i.listener=t,this.on(e,i),this},t.off=function(e,t){var i=this._getEvents();if(0===arguments.length)return this._events={},this;var n=i[e];if(!n)return this;if(1===arguments.length)return delete i[e],this;for(var o,r=0;r<n.length;r++)if((o=n[r])===t||o.listener===t){n.splice(r,1);break}return this},t.emit=function(e){var t=this._getEvents(),i=t[e],n=Array.prototype.slice.call(arguments,1);if(i){i=i.slice(0);for(var o=0,r=i.length;o<r;o++)i[o].apply(this,n)}return this},t.listeners=function(e){return this._getEvents()[e]||[]},t.setMaxListeners=function(e){return this.maxListeners=e,this},e.mixin=function(t){for(var i in e.prototype)t[i]=e.prototype[i];return t},e}),define("im-lib/userData",[],function(){function e(e){return e.replace(o,"___")}function t(){}function i(){if(!n)try{return n=document.createElement("input"),n.type="hidden",n.addBehavior("#default#userData"),document.body.appendChild(n),!0}catch(e){return n={load:t,save:t,getAttribute:t,setAttribute:t,removeAttribute:t},!1}return!0}var exports={},n=null,o=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g"),r=location.hostname+"_bridge_im";return exports.setItem=function(t,o){if(i()){t=e(t);var a=new Date;a.setDate(a.getDate()+365),n.expires=a.toUTCString(),n.load(r),n.setAttribute(t,o),n.save(r)}},exports.getItem=function(t){if(!i())return"";else return t=e(t),n.load(r),n.getAttribute(t)},exports.removeItem=function(){if(i())key=e(key),n.load(r),n.removeAttribute(key),n.save(r)},exports.clear=function(){var e=new Date;e.setDate(e.getDate()-1),n.expires=e.toUTCString()},exports}),define("im-lib/localStorage",["require","./userData"],function(require){var e,exports={};try{e=window.localStorage||require("./userData")}catch(t){e=require("./userData")}return exports.setItem=function(t,i){try{e.setItem(t,i)}catch(e){}},exports.getItem=function(t){return e.getItem(t)},exports.removeItem=function(t){e.removeItem(t)},exports.clear=function(){e.clear()},exports}),define("im-lib/main",["require","./lang","./json","./net","./util","./Emitter","./localStorage"],function(require){return{lang:require("./lang"),json:require("./json"),net:require("./net"),util:require("./util"),Emitter:require("./Emitter"),localStorage:require("./localStorage")}}),define("im-lib",["im-lib/main"],function(e){return e}),define("im-core/main",["require","im-lib","im-lib/Emitter","bull","./bullConfig"],function(require){function e(module,e,t){module.on(e,function(){var i=Array.prototype.slice.call(arguments);i.unshift(t||e),exports.emit.apply(exports,i)})}var t=require("im-lib"),i=require("im-lib/Emitter"),exports={};i.mixin(exports);var n=!1;return exports.messageHandler=function(e,i){var n=i.adata&&t.json.parse(i.adata)||{},o=n.displayName||n.nickname||e.sinfo.nickname||i.from,r=1e3*i.time;exports.decode(i,function(e){exports.emit("message",e,o,r,i.msgHandlerType||"")})},exports.decode=function(e,t){},exports.init=function(e){var t=require("bull"),i=require("./bullConfig");t.init(i),exports.initCore(e)},exports.initCore=function(t,i,n,o,r){n.extend(exports,o),exports.addPlugin(),n.extend(i,r||{}),i.anonym=i.bid?0:1,t.on("message",exports.messageHandler);var a=["error","reconnect","connected","disconnect","offline","csoffline","invitefail","queueing","otherwebimalive","fetchhistorysuccess","fetchhistoryfail","fetchhistoryfinish","visitorblock","autoendtalk","currentIR","showMsgRemind","csonline","transferError","fininshIR","updateNewCSR","visitorTransfer","unknownMsg"];n.each(a,function(i){e(t,i)})},exports.addPlugin=function(){for(var e=0;e<arguments.length;e++)exports.plugin(arguments[e])},exports.connect=function(e,t,i,o,r){function a(a){if(i.isBlocked())return n={type:o,options:r},exports.emit("visitorblock",{blocktype:i.isBlocked()}),void exports.emit("blocked",{blocktype:i.isBlocked()});if(a.invited)a.status=3;switch(a.status){case 0:case 1:case 2:e.connect(o,r);break;case 3:if(r.invited||a.invited)a.invited=1,a.from=r.from,e.connect(o,a);else a.reason="talk to other",e.disconnect(a,function(i){if(t.usingWs)e.wsPickSucc(i),e.wsPick()}),e.setStopPick(!1),e.pick();break;case 4:e.connect(o,r);break;default:e.connect(o,r)}}if(exports.emit("startconnect"),i.isLogin())a(t);else i.login(a,function(){exports.emit("error",{type:"init"})},function(e){exports.emit("visitorblock",{blocktype:e})})},exports.checkcode=function(e,t){e.checkcode(t,function(){if(n)exports.connect(n.type,n.options),n=!1})},exports.confirm=function(e){e.confirm(function(){if(n)exports.connect(n.type,n.options),n=!1})},exports.auth=function(e,t,i){if(e.isLogin());else e.login(function(){exports.emit("connected")},function(){exports.emit("error",{type:"init"})})},exports.send=function(e,t,i,n){function o(){exports.emit("sendfinish",i),exports.emit("sendsuccess",i)}function r(){exports.emit("sendfail",i)}if(exports.emit("trysendmsg"),!e.isConnected())return exports.emit("sendfail",i),!1;else return t.encode(i,function(t){t.adata=n,e.send(t,o,r)},r),!0},exports.preSend=function(e,t,i){if(!e.isConnected())return!1;e.preSend({mtype:0,content:i.text})},exports.disconnect=function(e,t,i,n){if(exports.emit("sessioncut"),!1!==n)e.disconnect();if(!1!==i)t.logout()},exports.plugin=function(e,t){if(t.encoder)e.addEncoder(t.encoder);if(t.decoder)e.addDecoder(t.decoder);if(t.emit)t.emit=function(){var e=Array.prototype.slice.call(arguments);exports.emit.apply(exports,e)}},exports.get=function(e,t){return e.get(t)},exports.getConfig=function(e,t){return e[t]},exports.isConnected=function(e){return e.isConnected()},exports.sendOfflineMsg=function(e,t,i,n){function o(){exports.emit("sendofflinemsgfinish",i),exports.emit("sendofflinemsgsuccess",i)}function r(){exports.emit("sendofflinemsgfail",i)}if(e.isConnected())return exports.emit("sendofflinemsgfail",i),!1;else return t.encode(i,function(t){t.adata=n,e.send(t,o,r)},r),!0},exports.fetchHistory=function(e,t){e.fetchHistory(t)},exports.isBlocked=function(e){return e.isBlocked()},exports}),define("im-core",["im-core/main"],function(e){return e}),define("im-core/plugin/fileTransfer",["require","../main"],function(require){var e=1,exports={};exports.encoder={};var t=exports.encoder;t.fileAccept=function(t,i){i({mtype:e,content:{type:"file",data:{bcsName:t.bcsName,name:t.name,size:t.size,type:"accept"}}})},t.fileVUpload=function(t,i){i({mtype:e,content:{type:"file",msgInfo:t.msgInfo,data:{status:t.status,bcsName:t.bcsName,name:t.name,size:t.size,type:"vUpload"}}})},t.fileVDownLoad=function(t,i){i({mtype:e,content:{type:"file",data:{status:t.status,bcsName:t.bcsName,name:t.name,type:"vDownLoad"}}})},t.fileVCancelSend=function(t,i){i({mtype:e,content:{type:"file",data:{bcsName:t.bcsName,name:t.name,type:"vCancelSend"}}})},exports.decoder={};var i=require("../main");return exports.decoder.fileTransfer=function(e,t){e=e||{};var n=e.content||{},o=n.data||{},r=n.msgInfo||{},a={bcsName:o.bcsName,name:o.name},s="";switch(o.type){case"accept":s="fileAccept",a.status=o.status;break;case"sDownLoad":s="fileSDownLoad",a.status=o.status;break;case"sUpLoad":s="fileSUpload",a.size=o.size;break;case"vCancelSend":s="vCancelSend";break;case"vDownLoad":s="vDownLoad",a.status=o.status;break;case"vUpload":s="vUpload"}i.emit(s,a,r,e.msgHandlerType||"")},exports}),define("qiao-im-msdk/plugin/fileTransfer",["im-core/plugin/fileTransfer"],function(e){return e}),define("im-core/const",[],function(){var exports={};return exports.PLATFORM_PC=0,exports.PLATFORM_MOBILE=1,exports.SERVER_TIEXIN=1,exports.SERVER_DUZHAN=2,exports.SERVER_QIAO=3,exports.AUTH_TYPE_LOCAL=0,exports.AUTH_TYPE_QIAO=4,exports.AUTH_TYPE_DUZHAN=5,exports.CHAT_TYPE_USER=0,exports.CHAT_TYPE_GROUP=1,exports.CHAT_TYPE_IR=4,exports.PUSH_TYPE_BYE=2,exports.PUSH_TYPE_CHAT=3,exports.PUSH_TYPE_OFFLINE=4,exports.PUSH_TYPE_FETCH_HISTORY=5,exports.PUSH_TYPE_PRE_SEND=6,exports.PUSH_TYPE_FETCH_SESSION_MESSAGE=7,exports.PUSH_TYPE_MSG_SYNC=9,exports.CHART_START_TYPE="vsturl:u",exports.BLOCK_TYPE={IP_BLOCK:1,BID_BLOCK:2,CONFIRM_BLOCK:3,CODE_BLOCK:4,DIRECT_BLOCK:5},exports}),define("qiao-im-msdk/const",["im-core/const"],function(e){return e}),define("im-core/config",["require","./const"],function(require){var e=require("./const");return{bid:"",siteid:"",eid:"",crossDomain:!1,platform:e.PLATFORM_PC,server:e.SERVER_QIAO,authType:e.AUTH_TYPE_QIAO,authToken:"bridge",urlRoot:"/",sid:"-100",tid:"-1",fromType:1,ttype:1,reasons:["vstreq:u","vstsys:u","vstwtr:u","vsturl:u","vstwtr:f","vstreq:f","vstsys:f"],isPageOnload:!0,isSessionConnected:!1,webSocket:!1,usingWs:!1,wsUrl:"/"}}),define("qiao-im-msdk/config",["im-core/config"],function(e){return e}),define("im-core/plugin/unknownMsg",["require","im-lib","../config","im-core"],function(require){function e(e,t){t({content:{content:{data:e.content,msgInfo:e.msgInfo||{},type:e.msgType||""},type:a},mtype:r})}function t(e,t){e=e||{};var a=e.content||{},c=a.content;if(a.mtype===o||a.mtype===r)try{c=i.json.parse(a.content),c.msgInfo=c.msgInfo||{};var u=e.adata&&i.json.parse(e.adata)||{};c.nickname=u.nickname||s}catch(e){c=a.content}c.role=e.from===n.bid?0:1,require("im-core").emit("unknownMsg",c)}var exports={},i=require("im-lib"),n=require("../config"),o=1,r=4,a="unable message",s="\u5bf9\u65b9";return exports.encoder={},exports.encoder[a]=e,exports.decoder={},exports.decoder["unable message"]=t,exports}),define("qiao-im-msdk/plugin/unknownMsg",["im-core/plugin/unknownMsg"],function(e){return e}),define("im-core/net",["require","im-lib"],function(require){function e(){}var exports={};require("im-lib").Emitter.mixin(exports);var t={INITIAL:0,INITIALIZED:1,DISABLED:2},i=t.INITIAL;return exports.canUseWs=function(e,n,o,r,a,s,c){return e.isSupportWs&&n.webSocket&&i!==t.DISABLED},exports.successFactory=function(e,t,i,n,o,r){var a=e;return function(e){try{if(-1!==Object.prototype.toString.call(e).indexOf("String"))e=t.parse(e)}catch(e){return void n()}if(a.set("sn",e.n_sn),!e.status||2===e.status)exports.emit("response",o||e.method,e.body||e),i(e.body||e);else{if(void 0===r)r=!0;if(r)exports.emit("auth invalid");n(e)}}},exports.wsCommands=function(e,n,o,r){return{getComCallback:function(e){return{"site/poll":{success:exports.successFactory(o.pickSuccess,o.pickFailure),failure:o.pickFailure},"chat/poll":{success:exports.successFactory(r.wsPickSucc,r.wsPickFail),failure:r.wsPickFail}}},changeStatus:function(n){i=n.status,e.usingWs=i===t.INITIALIZED},getBaseBody:function(t){return{auth:n.get(),e:e.eid,s:e.siteid,v:e.bid}},setAuth:function(t){n.set("key",t.key),e.bid=t.bid},request:function(e){exports.request(e.path,e.options,"downgrade")}}},exports.wsCallBack=function(e){return exports.wsCommands()[e.type](e.data)},exports.jsonToQuery=function(e,t,i){var n=[];return t.each(i,function(i,o){if(t.isObject(o))o=e.stringify(o);if("number"!=typeof o)o=encodeURIComponent(o);n.push(i+"="+o)}),n.join("&")},exports.request=function(n,o,r,a,s,c,u){var l=n.urlRoot+s;if(c.fullPath&&!0===c.fullPath)l=s;c=c||{};var f=c.failure||e,d=c.success||e;if("downgrade"===u)c.success=c.success;else if(!1===c.isneedlogout)c.success=exports.successFactory(d,f,s,!1);else c.success=exports.successFactory(d,f,s);var m=c.data||{};if(exports.emit("request",s,m),m.v=n.bid,m.s=n.siteid,m.e=n.eid,m.dev=n.platform,m.auth=o.get(),"chat/st"===s&&o.get("code_token"))m.code_token=o.get("code_token");if(c.data=null,exports.canUseWs(m,s,d,f,u)){if(i===t.INITIAL)r.initWs(n.wsUrl+"?v="+m.v,exports.wsCallBack);r.ws(s,m,c)}else if(n.crossDomain||c.crossDomain){if(l+=l.indexOf("?")>=0?"&":"?",l+=exports.jsonToQuery(m),c.type=m.type,c.key="cb",c.op=m.op,c.l=m.l,2===m.type&&"chat/push"===s&&!d&&!f||3===m.op&&"site/auth"===s&&!d&&!f||1===m.op&&"site/st"===s&&!d&&!f){var g=document.createElement("img");return void(g.src=l)}if("imgCross"===u)r.imgRequest(l);else r.jsonp(l,c)}else{if(c.method=c.method||"POST","POST"===c.method)c.data=a.stringify(m),l=l+"?v="+m.v;else l+=l.indexOf("?")>=0?"&":"?",l+=exports.jsonToQuery(m),l+="&v="+m.v;if(c.setCookie)l=l+"&s="+m.s,l=l+"&t="+c.setCookie;r.request(l,c)}},exports.auth=function(e,t,i,n,o){var r;if(0===e.visitType)r=t?0:1;else r=t?2:3;var a,s={success:n,failure:o,data:{op:r,dev:e.platform,ser:e.server,s_info:i}};if(!t)s.method="GET",a="imgCross";exports.request("site/auth",s,a)},exports.poll=function(e,t,i){var n={success:t,failure:i,data:{l:e?1:0}};exports.request("site/poll",n)},exports.site=function(e,t,i,n){var o,r={success:i,failure:n,data:{op:e?0:1,s_info:t,url:location.href}};if(!e)r.method="GET",o="imgCross";exports.request("site/st",r,o)},exports.chat=function(e,t,i){var n={success:t,failure:i,data:e};exports.request("chat/st",n)},exports.pick=function(e,t,i,n){var o={success:i,failure:n,data:{l:1,sid:t||""}};if(e.isPageOnload||!e.isSessionConnected)exports.request("chat/poll",o);else o.data.l=0,setTimeout(function(){exports.request("chat/poll",o)},3e3)},exports.push=function(e,t,i){var n={success:t,failure:i,data:e||{}};if(2===e.type)n.method="GET";exports.request("chat/push",n)},exports.node=function(e,t,i){var n={success:t,failure:i,data:e||{}};exports.request("bookmanage/saveBook.action",n)},exports.validate=function(e,t,i){var n={method:"GET",success:t,failure:i,data:e||{},isneedlogout:!1};exports.request("protection/validate",n)},exports.upload=function(e,t,i,n,o,r){t.upload(e.urlRoot+i,n,"file",o,r)},exports.getUploadUrl=function(e,t,i,n){return n=n||t.uuid(),e.urlRoot+"wupload/"+n+"/"+i.get("sid")},exports.getDownloadUrl=function(e,t,i,n,o){return n=n||t.uuid(),o=o||n,e.urlRoot+"wdownload/"+n+"/"+i.get("sid")+"/"+n+"?response-content-disposition=attachment;filename="+o},exports.getDomain=function(e){e=e||"";var t=/https?:\/\/([^\/]+)/i,i=e.match(t);return null!=i&&i.length>1?i[1]:""},exports.getParam=function(e,t){t=t||"";var i=t.substr(t.indexOf("?")),n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),o=i.substr(1).match(n);return o&&o.length>2?decodeURIComponent(o[2]):""},exports.getXstFromLink=function(e){var t="";if(!e)return t;var i=exports.getDomain(e);if(!i||i.indexOf("baidu.com")<0)return t;if(!(t=exports.getParam("xst",e))){var n=exports.getParam("reqParam",e)||"";try{n=JSON.parse(n)}catch(e){n={}}if(n.xst)t=n.xst}return t},exports.getXst=function(){var e=exports.getXstFromLink(location.href);if(!e&&exports.getParam("referer",location.href))e=exports.getXstFromLink(exports.getParam("referer",location.href));if(!e&&document.referrer)e=exports.getXstFromLink(document.referrer);return e},exports.log=function(e,t,i){var n=t+"/eye/log/js/stat.gif?";n+=exports.jsonToQuery(i),e.imgRequest(n)},exports}),define("qiao-im-msdk/net",["im-core/net"],function(e){return e}),define("im-core/chat",["require","im-lib","./config","./net"],function(require){function e(e){if(!e&&b.connected)exports.emit("disconnect");if(b.stopPick=!0,b.connected=!1,b.sid="",b.options&&1===b.options.invited)b.options.invited=0}function t(){if(!b.connected)if(b.csonline)if(!b.csonline||b.online)b.connected=!0,exports.emit("connected",{sid:b.sid}),p.each(b.msgPool,function(e){exports.emit("message",e)}),b.msgPool=[]}function i(t,i){var n={type:t};if(i)n.data=i;exports.emit("error",n),e()}function n(e,t){if(!e.pickType)b.sid=e.sid,b.to=e.uid,b.authType=e.authtype,b.csonline=!0,b.ttype=e.ttype;if(t)h.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{}}function o(){x={ifIR:!1,count:0,id:null}}function r(e){var t={},i=e.length-1;return p.each(e,function(n,o){var r=n.content.bcsName;if("img"===n.content.type&&!t[r]){if(o>=i)return P.push(e[i]),e;p.each(e,function(i,n){if("string"==typeof i.content){var a=document.createElement("div");a.innerHTML=i.content;var s=a.getElementsByTagName("img")[0];if(s&&s.tagName&&"IMG"===s.tagName.toUpperCase()&&s.id===r){var c=e.splice(o,1);e.splice(n,0,c[0]),t[r]=1}}})}}),e}function a(e){var t;if(e&&1===e.status&&"auth invalid"===e.errinfo)i("offline"),t=!0;return t}function s(e){if(L=0,M)M=!1,exports.emit("reconnect");if(exports.isConnected()){var t=b.options.siteid;if(t)m.localStorage.setItem("ACTIVE_"+t,+new Date)}p.each(e,function(e){var t=e.type,i=exports.pickHandler[t];if(i)i(e.msg)})}function c(e){if(++L>R&&!M)M=!0,exports.emit("offline")}function u(e){s(e),f()}function l(e){if(c(e),!a(e))setTimeout(function(){f()},3e3)}function f(){if(!b.stopPick)setTimeout(function(){v.pick(b.sid,u,l)},0)}var d,m=require("im-lib"),g=m.Emitter,p=m.lang,h=require("./config"),v=require("./net"),b={connected:!1,stopPick:!1,csonline:!1,msgPool:[],presend:{sending:!1,content:""}},y={INVITE:18,ACCEPT:20,BYE:28},I={OVER:4,TAKE_OVER:3,TRANSFER:6,RECEIVE:2},w="blocked",T="auto",S={SUCCESS:0,FAILURE:1},k={QUEUEING:2,TALKING:4},E=10,x={ifIR:!1,count:1,id:null},C={CSR:0,GROUP:1,IR:4},O={READY:0,BUSY:1,LEAVE:2,UNLOGIN:3},A={TRANSFER:0,CONVERSATION:1},_={COUNT:0,LIST:1,MSG_SYNC:0,END_TIME:0,PAGE:20,DEFAULT:5,DELAY:2e3},P=[],exports={};g.mixin(exports),v.on("auth invalid",function(){b.stopPick=!0}),exports.pickHandler={},exports.pickHandler[100]=function(e){if(e.op===y.ACCEPT)if(e.st===S.SUCCESS)_.END_TIME=e.systime||0,b.sid=e.sid,b.to=e.uid,b.authType=e.authtype,b.csonline=!0,b.online=!0,h.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{},exports.fetchOfflineMsg(),_.MSG_SYNC=e.systime||0;else exports.bye();if(e.op===y.BYE)if(e.st===S.SUCCESS){var t=b.options||{};if("talk to other"===e.reason)b.stopPick=!1,t.invited=0,t.tid=h.tid,t.ttype=1,t.sid="",t.from=5,exports.connect(t.ttype,t,!1)}else exports.emit("invitefail");if(e.op===y.INVITE){if(_.END_TIME=e.systime||0,"queue"===e.reason)return;if(e.ttype===C.IR)x.ifIR=!0,x.id=e.uid,exports.emit("currentIR");if("re_invite"===e.reason&&h.status===k.QUEUEING)return void exports.emit("queueing");if("re_invite"===e.reason){if(h.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{},b.sid=e.sid,b.to=e.uid,b.authType=e.authtype,b.tid=h.tid||"",b.ttype=e.ttype,b.csonline=!0,b.online=!0,h.syncSessionHistory)exports.fetchSessionMessage();return void exports.fetchOfflineMsg()}if(e.st===S.SUCCESS)b.sid=e.sid,b.to=e.uid,b.authType=e.authtype,b.csonline=!0,b.ttype=e.ttype,h.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{};else{var i=m.json.parse(e.adata||"{}");return b.to=i.uid||"-1",b.authType=e.authtype,b.csonline=!1,exports.emit("csoffline"),void exports.fetchOfflineMsg()}exports.fetchOfflineMsg()}},exports.pickHandler[101]=function(t){if(t.msgHandlerType=t.msgHandlerType||"",t.opr===I.OVER)if(t.reason&&-1!==t.reason.indexOf(w))exports.emit("visitorblock",t),e();else if(t.reason&&-1!==t.reason.indexOf(T))exports.emit("autoendtalk",t),e();else i("forceover");else if(t.opr===I.TAKE_OVER)if(n(t,!0),x.ifIR)o(),exports.emit("fininshIR",{type:"invite"});else exports.emit("updateNewCSR",h.sinfo);else if(t.opr===I.TRANSFER)if(n(t,!0),x.ifIR)o(),exports.emit("fininshIR",{type:"online"});else exports.emit("updateNewCSR",h.sinfo);else if(t.opr===I.RECEIVE){var r=t.detail||{};if(r.join_action===A.TRANSFER){var a=!1,s=t.adata&&m.json.parse(t.adata)||{},c=s.transfer||{},u=t.sinfo&&m.json.parse(t.sinfo)||{};if(c.status)a=!0,exports.emit("visitorTransfer",{nickname:u.nickname||""},t.msgHandlerType);n(t,a)}}},exports.pickHandler[103]=function(e){if(b.connected){if(exports.emit("message",e),x.ifIR&&e.from===x.id&&x.count)if(++x.count>=5)exports.emit("showMsgRemind",x.count),x.count=0}else b.msgPool.push(e)},exports.pickHandler[104]=function(e){if(h.status=e.status,e.status===k.QUEUEING)b.sid=e.sid,b.queueing=!0,exports.emit("queueing");if(e.status===k.TALKING)if(b.queueing=!1,b.sid=e.sid,b.online=!0,t(),x.ifIR)if(""!==e.reason)exports.emit("transferError",e)},exports.pickHandler[105]=function(e){if(d)clearTimeout(d),d=null;var t=e.detail||[];if(e.type===_.COUNT){var i=0;if(p.each(t,function(e,t){i+=e.count}),i<_.DEFAULT)i=_.DEFAULT;if(i>_.PAGE)i=_.PAGE;exports.fetchHistory({count:i})}else if(e.type===_.LIST){var n=t.length;if(t[0])_.MSG_SYNC=t[0].systime||_.MSG_SYNC;if(t[n-1])_.END_TIME=t[n-1].systime||_.END_TIME;t=P.concat(t),P=[],t=r(t),p.each(t,function(e,t){e.msgHandlerType="insertBefore",exports.emit("message",e)}),exports.fetchHisFinish(!0,e)}},exports.pickHandler[106]=function(e){b.sid=e.sid,b.to=e.uid,b.authType=e.authtype,b.csonline=!0,h.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{},exports.fetchOfflineMsg()},exports.pickHandler[107]=function(e){if(e.webmsg){var t=m.json.parse(e.webmsg);t.body.reverse(),p.each(t.body,function(e){var t=e.msg;t.msgHandlerType="insertBefore",t.time=parseInt(+t.time/1e3,10);var i=e.msg.content;if(m.lang.isArray(i))p.each(i,function(e){var i=e.pickType;if(i){var n=exports.pickHandler[i];if(e.msgHandlerType="insertBefore",n)n(e)}else t.content=e.content||e,t.mtype=e.mtype||0,exports.emit("message",t)})})}},exports.pickHandler[108]=function(e){if(x.ifIR&&e.status===O.READY)exports.emit("csonline",e,"IR");else if(!b.connected&&e.status===O.READY)exports.emit("csonline",e,"OFFLINE_MSG")},exports.receiveOfflineMsg=function(e){var t={sid:"",tid:b.tid,type:e.PUSH_TYPE_MSG_SYNC,tid_authtype:h.authType,param:{systime:_.MSG_SYNC}};v.push(t,null,null)},exports.fetchHisFinish=function(e,i){if(i=i||{},e)exports.receiveOfflineMsg(),exports.emit("fetchhistorysuccess");else exports.emit("fetchhistoryfail");exports.emit("fetchhistoryfinish",i),t()},exports.fetchHistory=function(e,t){t=t||{};var i=h.offlineMsgGetType||0,n=i?"":b.sid,o=i?"-1":b.tid,r=i?h.bid:b.to,a={sid:n,tid:o,type:e.PUSH_TYPE_FETCH_HISTORY,tid_authtype:h.authType,param:{type:1,gettype:i,from:r,max_count:t.count||E,from_authtype:b.authType,endtime:_.END_TIME}};v.push(a,null,exports.fetchHisFinish)},exports.fetchSessionMessage=function(e){var t=b.tid||"",i=t,n="";if(t.indexOf(":")){var o=t.split(":");i=o[0],n=o[1]||""}var r=m.json.stringify({tag:1,type:2,userId:i-0,subId:n-0,bid:h.bid}),a={sid:b.sid,tid:b.tid,type:e.PUSH_TYPE_FETCH_SESSION_MESSAGE,tid_authtype:h.authType,param:{webmsg:r}};v.push(a)},exports.bye=function(e){var t={sid:b.options.sid,tid:b.tid,type:e.PUSH_TYPE_BYE,tid_authtype:h.authType,param:{reason:"bye for invite error"}};v.push(t)};var L=0,M=!1,R=3;return exports.wsPickSucc=function(e){s(e)},exports.wsPickFail=function(e){c(e)},exports.pick=f,exports.connect=function(e,t,n,o,r){o=o||{},b.tid=o.tid||"",b.options=o;var a={op:0,sid:o.sid||"",tid:b.tid,tid_authtype:t.authType,invited:o.invited-0?1:0,rtype:o.route||0,ttype:n,inviterefer:location.href,sp_refer:o.sp_refer||"",reason:t.reasons[o.from]||e.CHART_START_TYPE};if(t.adata&&1!==o.noshowSmartInvite)a.adata=t.adata;v.chat(a,function(e){if(!1!==r)if(b.stopPick=!1,t.usingWs)exports.wsPickSucc(e),exports.wsPick();else f()},function(){i("connect")})},exports.wsPick=function(e){if(f(),e.usingWs)setTimeout(exports.wsPick,3e4)},exports.talking=function(e,i){if(i=i||{},e=e||{},h.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{},b.sid=e.sid,b.to=i.tid,b.authType=e.authtype,b.csonline=!0,b.online=!0,b.tid=e.tid||"",b.options=i,b.stopPick=!1,h.syncSessionHistory)exports.fetchSessionMessage();t(),f()},exports.queue=function(e,t){t=t||{},e=e||{},h.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{},b.sid=e.sid,b.to=e.uid,b.authType=e.authtype,b.csonline=!0,b.tid=e.tid||"",b.options=t,b.stopPick=!1,exports.emit("queueing"),f()},exports.preSend=function(e,t){if(t.content&&!0!==b.presend.sending&&t.content!==b.presend.content){t.mtype=0,t.to=b.to,t.time=(new Date).getTime(),t.rtype=b.ttype;var i={sid:b.sid||"",tid:b.to,type:e.PUSH_TYPE_PRE_SEND,tid_authtype:b.authType,param:t};v.push(i,function(e){b.presend.sending=!1},function(e){b.presend.sending=!1}),b.presend.sending=!0,b.presend.content=t.content}},exports.send=function(e,t,i,n){t.from=h.bid,t.to=b.to,t.time=(new Date).getTime(),t.rtype=b.ttype;var o={sid:b.sid||"",tid:b.to,type:b.csonline?e.PUSH_TYPE_CHAT:e.PUSH_TYPE_OFFLINE,tid_authtype:b.authType,param:t};if(void 0!==t.adata)o.adata=t.adata,delete t.adata;v.push(o,i,function(e){if(a(e),n)n()})},exports.disconnect=function(t,i,n){t=t||{};var o=void 0===t.tid_authtype?b.authType:t.tid_authtype;o=o||4,v.push({type:2,sid:t.sid||b.sid,tid:t.tid||b.to||-1,reason:t.reason||"",tid_authtype:o},i,n),e(!0)},exports.isConnected=function(){return b.connected},exports.get=function(e){return b[e]},exports.setStopPick=function(e){b.stopPick=e},exports.fetchOfflineMsg=function(e){if(h.syncFetchOfflineMsg){var i={sid:"",tid:"-1",type:e.PUSH_TYPE_FETCH_HISTORY,tid_authtype:h.authType,param:{type:_.COUNT,from:b.to,from_authtype:b.authType}};v.push(i,null,exports.fetchHisFinish),d=setTimeout(function(){t()},_.DELAY)}else t()},exports}),define("qiao-im-msdk/chat",["im-core/chat"],function(e){return e}),define("im-core/plugin/img",["require","im-lib","../chat","../net","im-core/chat","../main"],function(require){function e(e){return e=e.split(f?"\\":"/"),e.pop()}function t(e){return"wupload/"+e+"/"+a.get("sid")}function i(e,t){var i=require("im-core/chat");return t=t||"a.jpg","wdownload/"+e+"/"+i.get("sid")+"/"+t}function n(i,n){var o=(e(i.path),i.bcsName),r=t(o);c[r]={msg:i,done:n},n({mtype:0,content:'<img id="'+o+'" data-uploaded="0" data-bcsName="'+o+'"/>'});var a={mtype:l,content:{type:u,bcsName:o}},f=require("../main");s.upload(r,i.form||i.path,function(){a.content.status=0,n(a),f.emit("imgsendsuccess",{bcsName:o,id:i.mid,status:"success"})},function(){a.content.status=1,n(a),f.emit("imgsendfail",{bcsName:o,id:i.id,status:"fail"})})}function o(e,t){var n=e.content,o=n.bcsName,r=i(o,"img");t({type:u,bcsName:o,bcsUrl:r,status:n.status})}var r=require("im-lib").Emitter,a=require("../chat"),s=require("../net"),c={},u="img",l=1,f=/ window nt/i.test(navigator.userAgent),exports={};return r.mixin(exports),exports.encoder={},exports.encoder[u]=n,exports.decoder={},exports.decoder[u]=o,exports}),define("qiao-im-msdk/plugin/img",["im-core/plugin/img"],function(e){return e}),define("im-core/plugin/shake",["require","../main"],function(require){function e(e,t){t({mtype:n,content:{type:i}})}function t(e,t){require("../main").emit("shake",e.msgHandlerType||""),t()}var exports={},i="shake",n=4;return exports.encoder={},exports.encoder[i]=e,exports.decoder={},exports.decoder[i]=t,exports}),define("qiao-im-msdk/plugin/shake",["im-core/plugin/shake"],function(e){return e}),define("im-core/plugin/text",["require","../chat","../config","im-core/chat"],function(require){function e(e,t){var i=document.createElement("div");i.innerHTML=e.text||"";for(var n=i.getElementsByTagName("img"),o=n.length;o;o--){var r=n[o-1];if(r.getAttribute("data-bcsName")){var s=document.createElement("img");s.setAttribute("data-bcsName",r.getAttribute("data-bcsName")),s.setAttribute("data-uploaded",r.getAttribute("data-uploaded")),s.id=r.id,r.id="";var c=r.parentNode;c.insertBefore(s,r),c.removeChild(r)}}t({mtype:a,content:i.innerHTML.replace(/\r|\n/gi,"")||""})}function t(e,t){var i=require("im-core/chat");return t=t||"a.jpg",o.urlRoot=o.urlRoot||"",o.urlRoot+"wdownload/"+e+"/"+i.get("sid")+"/"+t}function i(e){var i=document.createElement("div");i.innerHTML=e;for(var n=i.getElementsByTagName("img"),o=0;o<n.length;o++){var r=n[o],a=r.getAttribute("data-bcsName"),s=r.getAttribute("data-bcsUrl");if(a&&!s)s=t(a,a),r.setAttribute("data-bcsUrl",s)}return i.innerHTML}function n(e,t){var n=(require("../chat"),i(e.content)),a=e.from===o.bid?0:1;t({type:r,role:a,time:1e3*e.time,text:n||""})}var o=(require("../chat"),require("../config")),r="text",a=0,exports={};return exports.encoder={},exports.encoder[r]=e,exports.decoder={},exports.decoder[a]=n,exports}),define("qiao-im-msdk/plugin/text",["im-core/plugin/text"],function(e){return e}),define("im-core/plugin/transfer",[],function(){function e(e,t){t({mtype:n,content:{type:i}})}function t(e,t){t()}var exports={},i="transfer",n=4;return exports.encoder={},exports.encoder[i]=e,exports.decoder={},exports.decoder[n]=t,exports}),define("qiao-im-msdk/plugin/transfer",["im-core/plugin/transfer"],function(e){return e}),define("im-core/plugin/uploaded",[],function(){function e(e,t){t({mtype:n,content:{type:i,bcsName:e.bcsName,status:0}})}function t(e,t){t()}var exports={},i="img",n=1;return exports.encoder={},exports.encoder.uploaded=e,exports.decoder={},exports.decoder.uploaded=t,exports}),define("qiao-im-msdk/plugin/uploaded",["im-core/plugin/uploaded"],function(e){return e}),define("im-core/plugin/voice",["require","../config"],function(require){function e(e,t){t({mtype:o,content:e})}function t(e,t){var o=e.content,s=e.from===i.bid?0:1;t({type:n,role:s,text:r+o.text,bcsName:o.bcsName,fetchURL:a.replace(/#{bcsName}/g,o.bcsName),duration:o.duration,token:o.token})}var i=require("../config"),n="voice",o=2,r="\u8bed\u97f3\u8f6c\u8bd1\uff1a",a='//p.qiao.baidu.com/cps/audio/getAudio?reqParam={"audioName": "#{bcsName}"}',exports={};return exports.encoder={},exports.encoder[n]=e,exports.decoder={},exports.decoder[n]=t,exports}),define("qiao-im-msdk/plugin/voice",["im-core/plugin/voice"],function(e){return e}),define("im-core/plugin/location",["require","../config"],function(require){function e(e,t){t({mtype:o,content:e})}function t(e,t){var o=e.from===i.bid?0:1;e.content.type=n,e.content.role=o,e.content.text=r,t(e.content)}var i=require("../config"),n="location",o=4,r="[\u5730\u7406\u4f4d\u7f6e]",exports={};return exports.encoder={},exports.encoder[n]=e,exports.decoder={},exports.decoder[n]=t,exports}),define("qiao-im-msdk/plugin/location",["im-core/plugin/location"],function(e){return e}),define("im-core/plugin/config",["require","./fileTransfer","./unknownMsg","./img","./shake","./text","./transfer","./uploaded","./voice","./location"],function(require){return{package:"coreplugin",resource:{fileTransfer:require("./fileTransfer"),unknownMsg:require("./unknownMsg"),img:require("./img"),shake:require("./shake"),text:require("./text"),transfer:require("./transfer"),uploaded:require("./uploaded"),voice:require("./voice"),location:require("./location")}}}),define("qiao-im-msdk/plugin/config",["im-core/plugin/config"],function(e){return e}),define("im-lib/websocket/config",[],function(){return{wsUrl:"/",majorVer:"1",minorVer:"0",protocol:"0",reqTimeout:2e4,wsTimeout:3e4}}),define("im-lib/websocket/const",[],function(){return{MSGINITSTATUS:{INITIAL:0,INITIALIZED:1},WSINITSTATUS:{INITIAL:0,INITIALIZING:1,INITIALIZED:2},WSSTATUS:{CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},REQMSGTYPE:{CONTROL:0,BEAT:1,TEXT:2},REQPROTYPE:{BEAT:0,REQUEST:2,ACK:5},REQSTATUS:{UNSENT:0,SENT:1,CONFIRMED:2},RESPPROTYPE:{BEATACK:1,ACK:3,REQUEST:4}}}),define("im-lib/websocket/index",["require","./const"],function(require){function e(e){return g[e.type](e.data)}function t(e){return{seqId:parseInt(e.substr(2,8),10),type:parseInt(e.substr(10,1),10)}}var exports={},i=require("./const"),n=1,o=1,r=i.MSGINITSTATUS.INITIAL,a={},s={},c={},u={},l=null,f=null,d={"site/auth":i.REQMSGTYPE.CONTROL,"site/st":i.REQMSGTYPE.CONTROL,"site/poll":i.REQMSGTYPE.BEAT,"chat/st":i.REQMSGTYPE.CONTROL,"chat/poll":i.REQMSGTYPE.BEAT,"chat/push":i.REQMSGTYPE.TEXT,ack:i.REQMSGTYPE.ACK},m={"site/auth":i.REQPROTYPE.REQUEST,"site/st":i.REQPROTYPE.REQUEST,"site/poll":i.REQPROTYPE.BEAT,"chat/st":i.REQPROTYPE.REQUEST,"chat/poll":i.REQPROTYPE.BEAT,"chat/push":i.REQPROTYPE.REQUEST,ack:i.REQPROTYPE.ACK},g={disabled:function(e){l({type:"changeStatus",data:{status:2}});for(var t in s)if(s.hasOwnProperty(t)){var i=s[t];clearTimeout(i.timeOut);var n=i.data.substr(20);try{n=JSON.parse(n);var o=i.options,r=n.method.substr(1);delete n.method,delete n.header,delete n.msgid,o.data=n,l({type:"request",data:{path:r,options:o}})}catch(e){}}},message:function(e){exports.dealMsg(e)}};return exports.generateHead=function(e,t,i){return t.majorVer+t.minorVer+e.padLeft(i.seqId,8)+i.type+t.protocol+"00001111"},exports.generateCookie=function(e){for(var t=["H_BDCLCKID_SF","BAIDUID","BDSFRCVID","eqid"],i=[],n=0;n<t.length;n++){var o=t[n],r=e.getCookie(o,!1);if(r)i.push(o+"="+r+";")}if(i.length>0)i=i.join(" ");return i},exports.encodeMsg=function(e,t,o,r){var a={};if(a.type=m[t],a.msgType=d[t],a.status=i.REQSTATUS.UNSENT,a.msgid=e.msgid(),a.type===i.REQPROTYPE.ACK)a.seqId=r.seqId;else a.seqId=n++;o.msgid=a.msgid,o.method="/"+t,o.header={cookie:exports.generateCookie(),userAgent:window.navigator.userAgent||""};var s=exports.generateHead(a);return a.data=s+JSON.stringify(o),a.options=r,a},exports.sendMsg=function(e,t,n,o,r){function a(){t.send(c.data),c.timeOut=setTimeout(a,e.reqTimeout)}var c=exports.encodeMsg(n,o,r);if(c.type===i.REQPROTYPE.REQUEST)s[c.seqId]=c,u[c.msgid]=c,a(),c.status=i.REQSTATUS.SENT;else t.send(c.data)},exports.decodeMsg=function(e){var i={},n=t(e.substr(0,20));if(i.seqId=n.seqId,i.type=n.type,i.body=""===e.substr(20)?{}:JSON.parse(e.substr(20)),null===f&&i.body.body){var o=i.body.body[0];l({type:"setAuth",data:{key:o.key,bid:o.msg.v}})}return i},exports.dealMsg=function(e){var t=exports.decodeMsg(e);if(t.type===i.RESPPROTYPE.ACK){var n=s[t.seqId];clearTimeout(n.timeOut),n.status=i.REQSTATUS.CONFIRMED,delete s[t.seqId]}else if(t.type===i.RESPPROTYPE.REQUEST){if(null===f)f=l({type:"getBaseBody",data:{}});if(exports.sendMsg("ack",f,{seqId:t.seqId}),t.seqId===o)do{try{if(u[t.body.msgid]){var n=u[t.body.msgid];n.options.success(t.body),delete u[t.body.msgid]}else a[t.body.method].success(t.body);delete c[o]}catch(e){}finally{o++}}while(t=c[o]);else if(t.seqId>o)c[t.seqId]=t}},exports.init=function(t,n,o,s){if(r===i.MSGINITSTATUS.INITIAL)n.wsUrl=o,l=s,a=l({type:"getComCallback"}),t.init(e),r=i.MSGINITSTATUS.INITIALIZED,l({type:"changeStatus",data:{status:1}})},exports}),define("im-lib/websocket/websocket",["require","./const"],function(require){function e(e){if(a.readyState===r.WSSTATUS.OPEN)u=r.WSINITSTATUS.INITIALIZED,s=3,exports.pushAllMsgs()}function t(e){l({type:"message",data:e.data})}function i(e){}function n(e){if(u=r.WSINITSTATUS.INITIAL,s-- >0)exports.init(l);else l({type:"disabled",data:c})}function o(){a.addEventListener("open",e),a.addEventListener("message",t),a.addEventListener("error",i),a.addEventListener("close",n)}var exports={},r=require("./const"),a=null,s=3,c=[],u=r.WSINITSTATUS.INITIAL,l=null;return exports.pushAllMsgs=function(){for(var e=null;e=c.shift();)a.send(e)},exports.send=function(e){if(u===r.WSINITSTATUS.INITIALIZED)a.send(e);else c.push(e)},exports.close=function(){a.close()},exports.init=function(e,t){if(u===r.WSINITSTATUS.INITIAL)u=r.WSINITSTATUS.INITIALIZING,a=new WebSocket(e.wsUrl),setTimeout(function(){if(u===r.WSINITSTATUS.INITIALIZING)exports.close()},e.wsTimeout),l=t,o()},exports}),define("im-lib/config",["require","./lang","./json","./net","./util","./Emitter","./localStorage","./main","./websocket/config","./websocket/const","./websocket/index","./websocket/websocket"],function(require){return{package:"imLib",resource:{lang:require("./lang"),json:require("./json"),net:require("./net"),util:require("./util"),Emitter:require("./Emitter"),localStorage:require("./localStorage"),main:require("./main"),wsConf:require("./websocket/config"),wsConst:require("./websocket/const"),ws:require("./websocket/index"),wssocket:require("./websocket/websocket")},injection:[{id:"imLib.net",method:{initWs:["imLib.ws"],ws:["imLib.ws"]}},{id:"imLib.ws",method:{generateHead:["imLib.util","imLib.wsConf"],generateCookie:["imLib.util"],encodeMsg:["imLib.util"],sendMsg:["imLib.wsConf","imLib.wssocket"],init:["imLib.wssocket","imLib.wsConf"]}},{id:"imLib.wssocket",method:{init:["imLib.wsConf"]}}]}}),define("im-core/auth",["require"],function(require){var e={},exports={};return exports.get=function(t,i){var n={anonym:t.anonym,key:e.key||"",sn:e.sn||"",id:t.bid||"",from:t.authType,token:t.authToken||""};if(i)return n[i]||e[i];else return n},exports.set=function(t,i){e[t]=i},exports}),define("qiao-im-msdk/auth",["im-core/auth"],function(e){return e}),define("im-core/message",["require"],function(require){function e(){}function t(t,i){return t=t||e,i=i||e,function(e){if(!1===e)i();else if(e)t(e)}}var i={},n={},exports={};return exports.encode=function(e,n,o){var r=i[e.type];if(!r)throw e.type+" message not supported";r(e,t(n,o))},exports.decode=function(e,i,o){var r=e.mtype;if(1===r||4===r||2===r)if(e.content&&e.content.type)if("file"===(r=e.content.type))r="fileTransfer";var a=n[r];if(a)a(e,t(i,o));else if(o)o()},exports.addEncoder=function(e,t){e.each(t,function(e,t){i[e]=t})},exports.addDecoder=function(e,t){e.each(t,function(e,t){n[e]=t})},exports}),define("qiao-im-msdk/message",["im-core/message"],function(e){return e}),define("im-core/site",["require"],function(require){var exports={};return exports.init=function(e,t,i){t.extend(e,i||{}),e.anonym=e.bid?0:1},exports.enter=function(e,t,i){if(t=t||function(){},i=i||function(){},e.isLogin())t();else e.login(t,i)},exports.leave=function(e){if(e.isLogin())e.logout()},exports}),define("qiao-im-msdk/site",["im-core/site"],function(e){return e}),define("im-core/user",["require","./net"],function(require){function e(){clearTimeout(t),t=null,i=!1}var exports={};require("./net").on("auth invalid",function(){e()});var t,i,n={INVITE:1,AUTH:2},o=null,r=!1;exports.heartBeat=function(e){function i(){t=setTimeout(exports.heartBeat,15e3)}e.poll(!1,i,i)},exports.wsHeartBeat=function(e,t){if(t.poll(!1,exports.refresh,exports.refresh),e.usingWs)o=setTimeout(exports.wsHeartBeat,3e4)};var a={};return exports.pickSuccess=function(e,t){e.each(t,function(e){var t=a[e.type+""];if(t)t(e.msg)})},exports.pickFailure=function(){},exports.refresh=function(e,t,n){function o(){t.poll(r,function(t){e.each(t,function(e){var t=a[e.type+""];if(t)t(e.msg)}),exports.refresh()},function(){setTimeout(exports.refresh,3e3)})}if(i){var r=Boolean(n.isPageOnload);if(r)o();else setTimeout(o,3e3)}},exports.pickHandler1=function(e,t,i,n){if("invite"===n.reason)i.sid=n.sid,i.tid=n.uid,i.fromType=2,i.ttype=0,e.emit("initiative",n);else if("chat"===n.reason)i.sid=n.sid,i.tid=n.uid,i.ttype=n.ttype,i.invited=1,i.sinfo=n.sinfo&&t.parse(n.sinfo)||{},e.emit("forcetalk",n)},exports.pickHandler104=function(e,t,i,n){if(t.status=n.status,e.emit("watchStatus",n),t.usingWs)i.pickHandler[104](n)},a[1]=function(e){exports.pickHandler1(e)},a[104]=function(e){exports.pickHandler104(e)},exports.getInfo=function(e,t){function i(){var e=(new Date).getTimezoneOffset(),t=parseInt(e/60,10),i=e%60,n="-";if(t<0||i<0)if(n="+",t=-t,i<0)i=-i;return t+="",i+="","UTC"+n+t+":"+i}var n=window.navigator,o=window.screen;return{lang:n.language||n.systemLanguage,cbit:o.colorDepth,rsl:o.width+"*"+o.height,tz:i(),xst:encodeURIComponent(t.getXst()),referrer:encodeURIComponent(document.referrer)}},exports.enter=function(e,t,i){e.site(!0,exports.getInfo(),function(e){if(!exports.checkEnterResult(e,t,i))exports.getEnterResult(t,i)},i)},exports.checkEnterResult=function(e,t,n,o,r){var a=!1;if(!n.length)return a;else return e.each(n,function(n){if(100===n.type){var s=n.msg||{};if(3===s.status&&0===t.visitType){var c=t.tid||"",u=t.sid||"";e.extend(t,s),t.tid=c,t.sid=u}else e.extend(t,s);if(a=!0,i=!0,t.usingWs)exports.wsHeartBeat();else exports.refresh();o(n.msg)}else r()}),a},exports.checkAuthResult=function(e,t,i,o,a,s,c,u){var l=!1;return i.each(a,function(i){if(i.type===n.AUTH){if(l=!0,i=i.msg||{},!i.valid&&(i.blocktype===t.BLOCK_TYPE.IP_BLOCK||i.blocktype===t.BLOCK_TYPE.BID_BLOCK||i.blocktype===t.BLOCK_TYPE.DIRECT_BLOCK))return u&&u(i.blocktype),r=i.blocktype,void e.emit("blocked",{blocktype:i.blocktype});if(!i.valid&&(i.blocktype===t.BLOCK_TYPE.CONFIRM_BLOCK||i.blocktype===t.BLOCK_TYPE.CODE_BLOCK))return r=i.blocktype,o.bid=i.v,void exports.enter(s,c);if(i.valid)o.bid=i.v,exports.enter(s,c);else c()}}),l},exports.getEnterResult=function(e,t,i){e.poll(!0,function(e){if(!exports.checkEnterResult(e,t,i))exports.getEnterResult(t,i)},i)},exports.getAuthResult=function(e,t,i,n,o){t.poll(!0,function(e){if(!exports.checkAuthResult(e,i,n,o))exports.getAuthResult(i,n,o)},n)},exports.isLogin=function(){return!!t||i},exports.login=function(e,t,i,n,o,r){if(!exports.isLogin())e.auth(!0,exports.getInfo(),function(e){if(t.set("key",e.key||e[0].key),i.bid=e.v||e[0].msg.v,!exports.checkAuthResult(e,n,!1,r))exports.getAuthResult(n,o,r)},o);else n()},exports.checkcode=function(e,t,i,n,o,a){var s=function(){e.emit("codeinvalidated")},c=function(t){if(t&&0===t.status)i.set("code_token",t.data.code_token),r=!1,e.emit("codevalidated"),a();else s()};t.validate({from:"chat",code:o,bid:n.bid},c,s)},exports.confirm=function(e,t,i){t.set("code_token","CONFIRM_CLICK"),r=!1,i()},exports.logout=function(t){e(),t.site(!1),t.auth(!1)},exports.extendPickHandler=function(e,t){e.extend(a,t.pickHandler)},exports.isBlocked=function(){return r},exports}),define("qiao-im-msdk/user",["im-core/user"],function(e){return e}),define("im-core/log",["require"],function(require){var exports={};return exports.send=function(){},exports}),define("qiao-im-msdk/log",["im-core/log"],function(e){return e}),define("im-core/bullConfig",["require","./plugin/config","im-lib/config","./main","./auth","./config","./const","./chat","./message","./site","./user","./net","./log"],function(require){return{package:"core",importConfig:[require("./plugin/config"),require("im-lib/config")],resource:{main:require("./main"),auth:require("./auth"),config:require("./config"),consts:require("./const"),chat:require("./chat"),message:require("./message"),site:require("./site"),user:require("./user"),net:require("./net"),log:require("./log")},injection:[{id:"core.main",method:{initCore:["core.chat","core.config","imLib.lang","core.consts"],connect:["core.chat","core.config","core.user"],auth:["core.user"],checkcode:["core.user"],confirm:["core.user"],send:["core.chat","core.message"],addPlugin:["coreplugin.fileTransfer","coreplugin.img","coreplugin.unknownMsg","coreplugin.shake","coreplugin.text","coreplugin.transfer","coreplugin.uploaded","coreplugin.voice","coreplugin.location"],preSend:["core.chat","core.message"],plugin:["core.message"],disconnect:["core.chat","core.user"],messageHandler:["core.config"],get:["core.chat"],getConfig:["core.config"],bindEvent:["core.main","communicate.handler"],isConnected:["core.chat"],sendOfflineMsg:["core.chat","core.message"],fetchHistory:["core.chat"],isBlocked:["core.user"]}},{id:"core.auth",method:{get:["core.config"]}},{id:"core.chat",method:{fetchHistory:["core.consts"],connect:["core.consts","core.config"],fetchSessionMessage:["core.consts"],bye:["core.consts"],preSend:["core.consts"],send:["core.consts"],fetchOfflineMsg:["core.consts"],receiveOfflineMsg:["core.consts"],wsPick:["core.config"]}},{id:"core.message",method:{addEncoder:["imLib.lang"],addDecoder:["imLib.lang"]}},{id:"core.net",method:{jsonToQuery:["imLib.json","imLib.lang"],getUploadUrl:["core.config","imLib.util","core.main"],getDownloadUrl:["core.config","imLib.util","core.main"],request:["core.config","core.auth","imLib.net","imLib.json"],auth:["core.config"],authOut:["core.user"],upload:["core.config","imLib.net"],initLog:["core.config","data.config"],log:["imLib.net"],pick:["core.config"],canUseWs:["imLib.util","core.config"],wsCommands:["core.config","core.auth","core.user","core.chat"],successFactory:["core.auth","imLib.json"]}},{id:"core.site",method:{init:["core.config","imLib.lang"],enter:["core.user"],leave:["core.user"]}},{id:"core.user",method:{refresh:["imLib.lang","core.net","core.config"],getInfo:["imLib.lang","core.net"],enter:["core.net"],checkEnterResult:["imLib.lang","core.config"],getAuthResult:["core.main","core.net"],checkcode:["core.main","core.net","core.auth","core.config"],confirm:["core.main","core.auth"],login:["core.net","core.auth","core.config"],logout:["core.net"],getEnterResult:["core.net"],pickHandler1:["core.main","imLib.json","core.config"],pickHandler104:["core.main","core.config","core.chat"],heartBeat:["core.net"],checkAuthResult:["core.main","core.consts","imLib.lang","core.config"],pickSuccess:["imLib.lang"],wsHeartBeat:["core.config","core.net"]}}],aspect:[{id:"core.message",pointCut:["core.main.decode, , decode"]},{id:"core.net",pointCut:["core.log.send, ,log"]}]}}),define("qiao-im-msdk/bullConfig",["im-core/bullConfig"],function(e){return e}),define("base/mobile/brower",[],function(){var e,t=document,i=new RegExp("msie (\\d+\\.\\d+)|trident","i");return{ie:function(){return i.test(navigator.userAgent)?t.documentMode||+RegExp.$1:e}(),isBDBox:/ baiduboxapp\//i.test(navigator.userAgent),opera:/opera(\/| )(\d+(\.\d+)?)(.+?(version\/(\d+(\.\d+)?)))?/i.test(navigator.userAgent)?+(RegExp.$6||RegExp.$2):void 0,isStrict:function(){return"CSS1Compat"===t.compatMode},isMobile:function(){return!!navigator.userAgent.match(/.*Mobile.*/)||"ontouchstart"in window}(),isIos:!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)}}),define("base/mobile/dom",["require"],function(require){var exports={};return exports.hide=function(e,t){if(e.isType(t,"Array"))for(var i=t.length;i--;){var n=this.g(t[i]);n&&(n.style.display="none")}},exports.show=function(e,t){if(e.isType(t,"Array"))for(var i=t.length;i--;){var n=this.g(t[i]);n&&(n.style.display="block")}},exports.appendHTML=function(e,t){e=e||"";var i=document.createElement("div");if(i.innerHTML=e,t)for(;i.firstChild;)t.appendChild(i.firstChild);return i.childNodes},exports.g=function(e,t){var i=null;if("string"==typeof t)i=document.getElementById(t);else if(e.isType(t,"HTML"))i=t;else if(t===window)i=t;return i},exports.setStyle=function(e,t){if(e.classList)e.classList.add(t);else{var i=e.className,n=i.split(/\s/);if(-1===n.indexOf(t))n.push(t),e.className=n.join(" ")}},exports.modifyClass=function(e,t,i){for(var n=e.className,o=n.split(/\s/),r={},a=0;a<o.length;a++)r[o[a]]=!0;if(i)r[t]=!0;else delete r[t];o=[];for(var s in r)if(r.hasOwnProperty(s))o.push(s);e.className=o.join(" ")},exports.addClass=function(e,t){this.modifyClass(e,t,!0)},exports.removeClass=function(e,t){this.modifyClass(e,t,!1)},exports}),define("base/mobile/event",["require","exports"],function(require,exports){function e(e,t,i){var n;return function(){var o=this,r=arguments,a=function(){if(n=null,!i)e.apply(o,r)},s=i&&!n;if(clearTimeout(n),n=setTimeout(a,t),s)e.apply(o,r)}}var t={};exports.on=function(e,i){(t[e]=t[e]||[]).push(i)},exports.off=function(e,i){var n=[].slice.call(arguments,0).length;if(0===n.length)return void(t=[]);if(1===n.length)return delete t[e],t;else return},exports.trigger=function(e){var i=[].slice.call(arguments,1),n=t[e];if(n)for(var o=n.length;o--;)n[o].call(this,i)},exports.domOn=function(t,i,n,o,r){var a=[];if(-1!==Object.prototype.toString.call(i).indexOf("Array"))for(var s=i.length;s--;)a.push(i[s]);else a.push(i);for(var c=a.length;c--;){var u=t.g(a[c]);if(u){if(r)o=e(o,100);u.addEventListener(n,o,!1)}}},exports.domOff=function(e,t,i,n){var o=e.g(t);if(o)o.removeEventListener(i,n,!1)},exports.getTarget=function(e){return e=e,e.target}}),define("base/mobile/lib",["require"],function(require){var exports={};return exports.getBid=function(){var e,t=(+new Date).toString(),i=Math.floor(1e5*Math.random()).toString(),n=5-i.length;if(n>0)for(e=0;e<n;e++)i+="0";return t+i},exports.uuid=function(){for(var e=[],t="0123456789abcdef",i=0;i<36;i++)e[i]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},exports.isType=function(e,t){return{}.toString.call(e).indexOf("[object "+t)>=0},exports.extend=function(e,t){for(var i in t)if(t.hasOwnProperty(i)&&"_belong"!==i)e[i]=t[i];return e},exports.hexToRgb=function(e,t){var i=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,n=e.toLowerCase();if(n&&i.test(n)){n=n.substr(1);var o="";if(3===n.length){for(var r=0;r<3;r++)o+=n.slice(r,r+1).concat(n.slice(r,r+1));n=o}for(var a=[],s=0;s<6;s+=2)a.push(parseInt("0x"+n.slice(s,s+2),16));if(t)return a;else return"RGB("+a.join(",")+")"}},exports}),define("base/baseMobileConfig",["require","./mobile/brower","./mobile/dom","./mobile/event","./mobile/lib"],function(require){return{package:"mbase",resource:{brower:require("./mobile/brower"),dom:require("./mobile/dom"),events:require("./mobile/event"),lib:require("./mobile/lib")},injection:[{id:"mbase.events",method:{domOn:["mbase.dom"],domOff:["mbase.dom"]}},{id:"mbase.dom",method:{hide:["mbase.lib"],show:["mbase.lib"],g:["mbase.lib"]}}]}}),define("common/util",[],function(){function e(e,t){for(var i,n=/<%([^%>]+)?%>/g,o=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,r="var r = [];\n",a=0,s=function(e,t){return t?r+=e.match(o)?e+"\n":"r.push(data."+e+");\n":r+=""!==e?'r.push("'+e.replace(/"/g,'\\"')+'");\n':"",s};i=n.exec(e);)s(e.slice(a,i.index))(i[1],!0),a=i.index+i[0].length;return s(e.substr(a,e.length-a)),r+='return r.join("");',new Function("data",r.replace(/[\r\t\n]/g,""))(t)}function t(e){for(var t={},i=e.length;i--;){var n=e[i];if(-1!==Object.prototype.toString.call(n).indexOf("Object"))for(var o in n)if(n.hasOwnProperty(o))t[o]=n[o]}return t}function i(e,t){if(e){for(var i="",n=e.split("\x3c!-- end --\x3e"),o=n.length;o--;){var r=n[o];if(r){if(1===arguments.length)t=r.match(/\w{0,}( \-\->)/g)[0].match(/\w/g).join("");var a="\x3c!-- target: "+t+" --\x3e";if(-1!==r.indexOf(a))i=r}}return i}return""}function n(e,t){var i={};if(i.phoneReg=/(^(\d{3,4}(-?))?\d{7,8})$|^((\+86)|(86))?(1[0-9][0-9]{9})/,i.emailReg=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,null!=t.match(i[e]))return!0;else return!1}function o(e){if("string"!=typeof e)return e;else return e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/\"/g,"&quot;"),e=e.replace(/\'/g,"&apos;")}function r(e){var t={};if("object"==typeof e)for(var i in e)if(e.hasOwnProperty&&e.hasOwnProperty(i))if("object"==typeof e[i])t[i]=r(e[i]);else t[i]=e[i];return t}return{template:e,pickHtml:i,regext:n,filterXSS:o,extend:t,cloneObj:r,getHost:function(e){if("string"!=typeof e)return"";var t=document.createElement("a");return t.href=e,t.hostname},isNativeFun:function(e){return/\{\s*\[native code\]\s*\}/.test(""+e)},trim:function(e){var t=new RegExp("(^[\\s\\t\\xa0\\u3000]+)|([\\u3000\\xa0\\s\\t]+$)","g");return String(e).replace(t,"")},getLocationUrl:function(e){if(e=e||{},!e.x||!e.y)return"";else return"//map.baidu.com/mobile/webapp/place/marker/qt=inf&vt=map&act=read_share&code=/point="+encodeURIComponent(e.x+"|"+e.y)+"&title="+encodeURIComponent(e.name||"")+"&content="+encodeURIComponent(e.alias||"")},getLocationImgUrl:function(e){if(e=e||{},!e.x||!e.y)return"";var t=e.x,i=e.y,n=e.zoom||15;return"//api.map.baidu.com/staticimage?width="+(e.width||220)+"&height="+(e.height||110)+"&center="+t+","+i+"&markers="+t+","+i+"&zoom="+n+"&markerStyles="+(e.style||"-1,//qiao.baidu.com/site/pinpc.png,-1")},isNaN:function(e){return"number"==typeof e&&+e!=+e},checkLoad:function(){var e=!1;if(e="complete"===document.readyState,document.documentElement.doScroll)try{document.documentElement.doScroll("left"),e=!0}catch(t){e=!1}return e}}}),define("lib/util",["common/util"],function(e){return e}),define("common/tpl",[],function(){var exports={},e={};return exports.parse=function(t){t=t||"";var i=0,n="";t.replace(/<\!\-\-\s*target:\s*(\w+)\s*\-\->/g,function(o,r,a){if(0!==a)e[n]=t.substring(i,a);n=r,i=a}),e[n]=t.substring(i,t.length)},exports.get=function(t){return e[t]||""},exports}),define("lib/tpl",["common/tpl"],function(e){return e}),define("common/view",["require"],function(e){var exports={};return exports.getWrap=function(e){return e.g("newBridge")},exports}),define("lib/view",["common/view"],function(e){return e}),define("common/cookie",[],function(){var exports={};return exports.get=function(e){var t=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),i=t.exec(document.cookie);return i?decodeURIComponent(i[2]):null},exports.set=function(e,t,i){i=i||{};var n;if(i.expires)if("number"==typeof(n=i.expires))n=new Date,n.setTime(i.expires+n.getTime());document.cookie=e+"="+encodeURIComponent(t)+(i.path?"; path="+i.path:"")+(i.expires?"; expires="+i.expires.toGMTString():"")+(i.domain?"; domain="+i.domain:"")+(i.secure?"; secure":"")},exports}),define("lib/cookie",["common/cookie"],function(e){return e}),define("common/mobileConfig",["require","./util","./tpl","./view","./cookie"],function(require){return{package:"common",resource:{util:require("./util"),tpl:require("./tpl"),view:require("./view"),cookie:require("./cookie")},injection:[{id:"common.view",method:{getWrap:["mbase.dom"]}}]}}),define("lib/mobileConfig",["common/mobileConfig"],function(e){return e}),define("embed/data/config",["require"],function(require){var exports={};return exports.staticDomain="//sgoutong.baidu.com",exports.getServer=function(e,t){var i=e.getWrap();return i={configBox:i.config,siteObj:i.siteConfig,startTime:i.startTime},i[t]||i},exports.isAutoInvite=function(){return!!(exports.getServer("configBox").inviteBox.autoInvite-0)},exports}),define("embed/data/bullConfig",["require","./config"],function(require){return{package:"data",resource:{config:require("./config")},injection:[{id:"data.config",method:{getServer:["common.view"]}}]}}),define("embed/embedChat/bid",["require"],function(require){function e(e,t,i){var n=i.OLDBIDKEY+e+"_BID",o=t.getItem(n);if(!o)return o;else return o=parseInt(o.substr(0,13),16).toString()}var exports={};return exports.init=function(t,i,n,o,r,a,s){if(i.isObject(s)&&void 0!==a&&""!==a)return a;var c=o.BIDPRE+r;if(!a)a=t.getItem(c)||e(r,t,o)||n.getBid();return t.setItem(c,a),a},exports}),define("embed/embedChat/consts",[],function(){return{OLDBIDKEY:"QIAO_LS_",BIDPRE:"NEWBRIDGE_BID_",TALKTYPEPRE:"NEWBRIDGE_TALK_TYPE_",DOMAIN:"//sgoutong.baidu.com"}}),define("embed/embedChat/mobile/leave",["require"],function(require){var e,exports={};return exports.init=function(t,i,n,o){n.domOn(window,"unload",function(){if(!e){var n=!0;if("invite"===i.visitState&&o.isIos)n=!1;t.disconnect(n,!1),e=!0}})},exports}),define("embed/embedChat/mobile/chat",["require","exports"],function(require,exports){function e(){}function t(e){var t=e;if(/^https:/.test(e))t=e.replace(/^https/,"http");else if(/^\/\//.test(e))t="http:"+e;return t}function i(e,t){function i(e,t){var i={BAR:"bar",ROUND:"round",SECTOR:"sector"};if(t)return i.BAR;switch(e){case 1:case 4:return i.ROUND;case 3:return i.SECTOR;default:return i.BAR}}function n(){function e(e){var t=100*c/window.innerHeight;return"center"===e?50+t/2:t}function t(){if("bottom"===v)return 100*(window.innerHeight-l)/window.innerHeight;else return 100*(l+c)/window.innerHeight+2}function i(){var e=16;return m>f?(f-e)/window.innerWidth*100:(m-e)/window.innerWidth*100}function n(){var e=.25;if(d/window.innerHeight>e&&l/window.innerHeight>e)return 2;else return 3}var r=o.position.split("-"),a=document.getElementById("nb_icon_wrap");if(a){var s=o.isFixedPosition,c=a.offsetHeight,u=a.offsetWidth,l=a.offsetTop,f=a.offsetLeft,d=window.innerHeight-(c+l),m=window.innerWidth-(u+f);if(1===s)return{float:r[0],vertical:"top"===r[1]?"top":"bottom",msgPosition:e(r[1]),maxShowNum:"center"===r[1]?2:3};else{var g=c/2+l,p=u/2+f,h=window.innerWidth/2>p?"left":"right",v=window.innerHeight/2>g?"top":"bottom";return{float:h,vertical:v,msgPosition:t(),maxShowNum:n(),offset:i()}}}else return{float:"right",vertical:"bottom",msgPosition:0,maxShowNum:3}}var o=t.seekIcon,r=t.webim,a=e.adata?e.adata:{};return{siteid:e.siteId,ucid:e.userId,userName:e.session&&e.session.uname,hisMsgCount:3,wrap:"newBridge",visitType:3,adata:a,webim:{size:1,btnColor:"#f00",companyDis:r.displayCompany?r.displayCompany:0,company:r.cpyInfo?r.cpyInfo:"",cpyTel:r.cpyTel?r.cpyTel:"",themeColor:r.webimLight.themeColor?r.webimLight.themeColor:"#4d74fa",isFullscreen:r.webimLight.isFullscreen?r.webimLight.isFullscreen:0,companyLogo:r.companyLogo?r.companyLogo:"http://s.goutong.baidu.com/r/image/logo.png",mobilePrologue:e.prologue?e.prologue:""},msgBubbleConfig:n(),icon:{size:2,enable:o.width&&o.height,theme:i(o.skinIndex,o.isCustomerStyle),width:o.width,position:o.position,height:o.height}}}var n={};exports.getDefaultParam=function(e){var t=e.getServer("siteObj");return{v:t.userId,s:t.siteId,dev:"1",type:0,sid:"-1",tid:"-1",tid_authtype:4}},exports.refuseSuccess=function(e,t,i){var n=e.g("nb_invite_wrap");if(n)n.style.display="none";t.fromType=1},exports.acceptSuccess=function(e,i,o,r,a,s,c){var u=c[1],l=o.getServer("siteObj"),f=o.getServer("configBox").inviteBox;if(l.isOpenMobileLite)exports.openMobileLite(!1,c[1]);else if(0===o.getServer("configBox").webim.isMobileWebim&&"true"===l.online){if(0!==u){if(l.invited=0,3===e.status&&e.tid)l.invited=1}else if(0===u)e.gid=-1,e.invited=0,e.tid="-1";exports.openMobileLite(!1,c[1])}else{var d={};if(0===c[1])d.from=0;else d.from=e.fromType;if(d.sessionid=e.sid,d.siteId=l.siteId,d.tid=e.tid||"-1",d.userId=l.userId,d.ttype=e.ttype,d.siteConfig=s.extend({},l),delete d.siteConfig.prologue,3===e.status)d.siteConfig.invited=1;else d.siteConfig.invited=0;if("false"===l.online)d.siteConfig.origin=document.title;var m=o.getServer("configBox").webim;if(d.config=new Object,d.config.themeColor=m.webim.themeColor.substring(1),e.adata)d.siteConfig.adata=e.adata;if(d.siteConfig.queuing="",e.expGroup)d.siteConfig.expGroup=e.expGroup;if(!d.siteConfig.bid&&e.bid)d.siteConfig.bid=e.bid;var g=i.getXst();if(g)d.xst=g;n.reqParam=d;var p=l.webRoot+"chatIndex";if(p=t(p),1==+f.smartBoxEnable&&1==+f.smartBoxOpen&&0==+f.likeCrm&&1==+f.autoInvite&&0!==c[1])exports.refuseSuccess(),exports.initSystemInvite();window.open(p+"?"+i.jsonToQuery(n),"mbNBBridage")}},exports.initSystemInvite=function(e){e.sid="-100",e.tid="-1",e.fromType=1,e.ttype=1},exports.watchStatus=function(e,t,i){var n=t.g("nb_invite_wrap"),o=t.g("nb_invite_smart_wrap"),r=t.g("nb_invite_abtest_wrap");if(3===i.status||"invite"==i.reason){if(n)n.style.display="block";if(o)o.style.display="none";if(r)r.style.display="none";e.visitState="invite"}else{if(n)n.style.display="none";if(o)o.style.display="none";if(r)r.style.display="none";e.visitState="",exports.initSystemInvite()}},exports.initiative=function(e,t,i){if(2===t.fromType||"to"===t.from){var n=e.g("nb_invite_wrap");if(n)n.style.display="block"}},exports.enterSuccess=function(e,t,i,n){if(n.length){var o=n[0].msg,r=e.g("nb_invite_wrap");if(void 0!=o.status)if(3===o.status){if(r)r.style.display="block";t.sid=o.sid,t.tid=o.tid,t.fromType=2,t.ttype=0}else if(4===o.status){if(r)r.style.display="none";clearTimeout(i.timeKey)}}},exports.builtComunicate=function(e,t,i,n,o){var r=n.getServer("siteObj");e.siteid=r.siteId,e.eid=r.eid,e.platform=1,e.urlRoot=r.webRoot,e.crossDomain=!0,e.visitType=1,t.init(e),i.init(e),i.enter(exports.enterSuccess),t.on("initiative",exports.initiative),t.on("watchStatus",exports.watchStatus),t.on("forcetalk",exports.forcetalk)},exports.forcetalk=function(e,t){var i=e.g("nb_invite_wrap");if(i)i.style.display="none";t.logForceTalk(),exports.openMobileLite(!0)},exports.openMobileLite=function(e,t,n,o,r){var a=n.getServer("siteObj"),s=i(a,n.getServer("configBox"));!a.isOpenMobileLite&&(a.isOpenMobileLite=1);var c=["icon:click","invite:click"];(0,(false||document.getElementById("newBridge")).require)(["embed/mobilelite/main"],function(t){if(t.init(s),o)t.emit("im:direct",{isForceTalk:!0,isBlocked:e.isBlocked()});else t.emit(c[r])})},exports.refuse=function(t,i){var n=exports.getDefaultParam();n.type=1,n.sid=t.sid,n.tid=t.tid,i.push(n,exports.refuseSuccess,e)},exports.accept=function(e,t){var i=exports.getDefaultParam();i.type=0,i.sid=e.sid,i.tid=e.tid,exports.acceptSuccess(arguments)}}),define("embed/embedChat/mConfig",["require","./bid","./consts","./mobile/leave","./mobile/chat"],function(require){return{package:"mchat",resource:{bid:require("./bid"),consts:require("./consts"),leave:require("./mobile/leave"),chat:require("./mobile/chat")},injection:[{id:"mchat.chat",method:{builtComunicate:["core.config","core.main","core.site","data.config","mchat.bid"],watchStatus:["core.config","mbase.dom"],initiative:["mbase.dom","core.config"],refuse:["core.config","core.net"],accept:["core.config"],enterSuccess:["mbase.dom","core.config","minvite.data"],acceptSuccess:["core.config","core.net","data.config","minvite.smartyInvite","mbase.brower","imLib.lang"],refuseSuccess:["mbase.dom","core.config"],initSystemInvite:["core.config"],getDefaultParam:["data.config"],openMobileLite:["core.main","core.config","data.config"],forcetalk:["mbase.dom","log.main"]}},{id:"mchat.leave",method:{init:["core.main","core.config","mbase.events","mbase.brower"]}},{id:"mchat.bid",method:{init:["imLib.localStorage","imLib.lang","mbase.lib","mchat.consts"]}}],aspect:[{id:"mchat.chat",pointCut:["minvite.main.init, , builtComunicate"]},{id:"mchat.leave",pointCut:["mchat.chat.builtComunicate, , init"]}]}}),define("embed/invite/inviteMain",["require"],function(require){var exports={};return exports.renderHtml=function(e,t,i,n,o,r,a){var s=t.getWrap(),c=i.getInviteStyle();if("pbase.dom"===e._belong)exports.renderHtml2(c,n,o,a,e,s,r)},exports.renderMobileHtml=function(e,t,i,n,o,r,a){var s=t.getWrap();if(1==+a.isFinshGetSmartAccessWise&&1==+a.isFinshGetShowTime){var c=i.getInviteStyle();exports.renderHtml2(c,n,o,a,e,s,r)}},exports.renderHtml2=function(e,t,i,n,o,r,a,s){if("pbase.dom"===r._belong)if(1==+o.isFinshGetSmartAccessWise&&1==+o.isUseSmartyInvite&&1==+o.isHasSmartAccess)t.renderWhich=3;var c=i.template(n,t);if(1===o.isShowWithToolbar)r.appendHTML(c,document.getElementById("nb_toolbar_wrap"));else r.appendHTML(c,a);s.process(),e.init()},exports.init=function(){exports.renderHtml()},exports}),define("embed/invite/inviteData",["require"],function(require){var exports={};return exports.getInviteStyle=function(e,t){var i=e.getServer("configBox").inviteBox;return t.dataProcess(i)},exports}),define("embed/invite/inviteHandler",["require"],function(require){var exports={};return exports.bindEvent=function(e,t,i){i.process();var n=i.getClickEle();e.domOn(n,"click",i.acceptInvite,!1),e.domOn([t.PREFIXID+"cancel",t.PREFIXID+"abtest_cancel",t.PREFIXID+"tool",t.PREFIXIDSMART+"cancel",t.PREFIXIDSMART+"tool"],"click",i.refuseInvite,!1),e.domOn([t.PREFIXID+"logo","nb-invite-access-close"],"click",i.accessSet,!1),e.domOn(["nb-invite-access-btn"],"change",i.closeSmartyInviteAccess,!1)},exports.init=function(){exports.bindEvent()},exports}),define("embed/mobilelite/lib/string",["require"],function(require){var e={amp:"&",lt:"<",gt:">",quot:'"',apos:"'"},exports={};return exports.encodeHTML=function(e){if(!e)return"";else return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},exports.decodeHTML=function(t){if(!t)return"";else return(t+"").replace(/\&([^;]+);/g,function(t,i){var n;if(i in e)return e[i];else if(n=i.match(/^#x([\da-fA-F]+)$/))return String.fromCharCode(parseInt(n[1],16));else if(n=i.match(/^#(\d+)$/))return String.fromCharCode(parseInt(n[1],10));return t})},exports.format=function(e,t){if(!e)return"";if(null==t)return e;var i="function"==typeof t?t:function(e){var i=t[e];return null==i?"":i};return(e+"").replace(/\$\{(.+?)\}/g,function(e,t){return i(t)})},exports.objectToString=function(e){var t=[],i=function(e){if("object"==typeof e&&null!==e)return this.objectToString(e);else return/^(string|number)$/.test(typeof e)?'"'+e+'"':e};for(var n in e)if(e.hasOwnProperty(n))t.push('"'+n+'":'+i(e[n]));return"{"+t.join(",")+"}"},exports}),define("embed/mobilelite/lib/object",["require","./string"],function(require){var e=require("./string"),exports={};exports.extend=function(e,t){for(var i=arguments.length,n=1;n<i;n++)if(t=arguments[n])for(var o in t)if(t.hasOwnProperty(o)&&void 0!==t[o])e[o]=t[o];return e},exports.extendOwn=function(e,t){for(var i=1,n=arguments.length;i<n;i++)if(t=arguments[i])for(var o in t)if(t.hasOwnProperty(o)&&e.hasOwnProperty(o)&&void 0!==t[o])e[o]=t[o];return e},exports.clone=function(e){for(var t={},i=0,n=arguments.length;i<n;i++)if(e=arguments[i])for(var o in e)if(e.hasOwnProperty(o)&&void 0!==e[o])t[o]=e[o];return t},exports.jsonToQuery=function(t){var i,n,o=[];for(var r in t)if(t.hasOwnProperty(r))if(i=t[r],exports.isArray(i))for(n=i.length;n--;)o.push(r+"="+encodeURIComponent(i[n]));else if(exports.isObject(i))o.push(r+"="+encodeURIComponent(e.objectToString(i)));else o.push(r+"="+encodeURIComponent(i));return o.join("&")};var t=Object.prototype.toString;return exports.isObject=function(e){return"[object Object]"===t.call(e)},exports.isString=function(e){return"[object String]"===t.call(e)},exports.isArray=function(e){return"[object Array]"===t.call(e)},exports.isNumber=function(e){return!!/^[0-9]+$/.test(e)},exports}),define("embed/mobilelite/lib/net/img",["require","../object"],function(require){var e=require("../object"),t=function(){var e=0;return function(){var t=(new Date).getTime();return t+="_"+e++}}(),exports={};return exports.request=function(i,n,o,r){if("function"==typeof n)r=o,o=n,n=null;(n=n||{}).t=t(),i+=(i.indexOf("?")>-1?"&":"?")+e.jsonToQuery(n);var a=new Image;a.onload=function(){a.onload=null,a.onerror=null,a=null,o&&o()},a.onerror=function(){a.onload=null,a.onerror=null,a=null,r&&r()},a.src=i},exports}),define("embed/mobilelite/lib/net/ajax",["require","../object","./img"],function(require){function e(){}function t(i,n){function o(){if(4===f.readyState){try{var t=f.status}catch(e){return void c("failure")}if(c(t),t>=200&&t<300||304===t||1223===t)c("success");else c("failure");window.setTimeout(function(){if(f.onreadystatechange=e,m)f=null},0)}}function r(){if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}if(window.XMLHttpRequest)return new XMLHttpRequest}function c(e){e="on"+e;var o=y[e],r=t[e];if(o){if(u)clearTimeout(u);if("onsuccess"!==e)o(f);else try{var c=f.responseText;c=new Function("return ("+c+")")(),n.onsuccess(c)}catch(e){return a.request(s,{errMsg:e.message||"",name:e.name||"",fileName:e.fileName||"",url:i,stack:e.stack||""}),n.onfailure(f)}}else if(r){if("onsuccess"===e)return;r(f)}}n=n||{};var u,l,f,d=n.data||"",m=!(!1===n.async),g=n.username||"",p=n.password||"",h=(n.method||"GET").toUpperCase(),v=n.headers||{},b=n.timeout||0,y={};for(l in n)if(n.hasOwnProperty(l))y[l]=n[l];if(0!==i.indexOf("http"))v["X-Requested-With"]="XMLHttpRequest";try{if(f=r(),"GET"===h){if(d)i+=(i.indexOf("?")>=0?"&":"?")+d,d=null;if(n.noCache)i+=(i.indexOf("?")>=0?"&":"?")+"b"+ +new Date+"=1"}if(g)f.open(h,i,m,g,p);else f.open(h,i,m);if(m)f.onreadystatechange=o;if("POST"===h)v["Content-Type"]=v["Content-Type"]||"application/x-www-form-urlencoded",f.setRequestHeader("Content-Type",v["Content-Type"]),delete v["Content-Type"];for(l in v)if(v.hasOwnProperty(l))f.setRequestHeader(l,v[l]);if(c("beforerequest"),b)u=setTimeout(function(){f.onreadystatechange=e,f.abort(),c("timeout")},b);if(f.send(d),!m)o()}catch(e){c("failure")}return f}function i(){return(new Date).getTime().toString(36)}function n(n,a){var s=a.onsuccess||e,c=a.onfailure||e;a.onsuccess=s,a.onfailure=c;var u=a.data||{};if(a.method===r)n+=(n.indexOf("?")>=0?"&":"?")+"_t="+i(),a.data=o(u);else u._t=i(),n+=(n.indexOf("?")>=0?"&":"?")+o(u),a.data=null;return t(n,a)}var o=require("../object").jsonToQuery,r="POST",a=require("./img"),s="http://sc.qiao.baidu.com/front/ajaxError.gif",exports={};return exports.post=function(e,t,i,o){return n(e,{method:r,data:t,onsuccess:i,onfailure:o})},exports.get=function(e,t,i,o){return n(e,{method:"GET",data:t,onsuccess:i,onfailure:o})},exports}),define("embed/mobilelite/lib/net/jsonp",["require","../object","./img"],function(require){"use strict";function e(e,n){var s=r(),c=null,h=n.timeout||null,v=n.callbackKey||d,b=s,y=n.data||{};y.t=(new Date).getTime();var I=n.charset||m,w=function(e){n.onsuccess&&n.onsuccess(e),i(c),o(b)},T=function(){n.onfail&&n.onfail(),i(c),o(b)},S=a({url:e+t(e,y,v,b),charset:I,id:s});if(l[s]=u[s]=function(){try{w.apply(null,arguments)}catch(t){g.request(p,{type:"jsonp",errMsg:t.message||"",name:t.name||"",fileName:t.fileName||"",url:e,stack:t.stack||""}),T.apply(null,arguments)}},f[s]=function(){T.apply(null,arguments)},h)c=setTimeout(function(){c=null,S.abort(),T.call(null)},h);return S.send(),S}function t(e,t,i,n){var o={}.toString.call(t),r="?";if(e.indexOf("?")>-1)r="&";var a=r+i+"="+n;if("[object Object]"===o)a+="&"+s(t);return a}function i(e){if(e)clearTimeout(e),e=null}function n(e){if(u[e])u[e]=h(e),l[e]=null,delete l[e]}function o(e){try{l[e]=null,u[e]=null,delete l[e],delete u[e]}catch(e){}}function r(){return"cxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function a(e){var t,i=c.head||c.getElementsByTagName("head")&&c.getElementsByTagName("head")[0]||c.body;return{send:function(){t=c.createElement("script"),t.async=!0,t.charset=e.charset,t.src=e.url,t.id=e.id,t.onload=t.onreadystatechange=function(i){if(!0===i||!t.readyState||/loaded|complete/.test(t.readyState)){if(t.onload=t.onreadystatechange=null,t.parentNode)t.parentNode.removeChild(t);if(t=null,!0===i)n(e.id)}},t.onerror=function(){if(t.parentNode)t.parentNode.removeChild(t);if(f[t.id])f[t.id].call(null);t=null},i.insertBefore(t,i.firstChild)},abort:function(){if(t)t.onload(!0)}}}var s=require("../object").jsonToQuery,c=document,u=window,l={},f={},d="callback",m="utf-8",g=require("./img"),p="http://sc.qiao.baidu.com/front/ajaxError.gif",h=function(e){return function(){try{u[e]=null,delete u[e]}catch(e){}}};return{request:e}}),define("embed/mobilelite/lib/ajax",["require","./net/ajax","./net/jsonp","./net/img"],function(require){var e=require("./net/ajax"),t=require("./net/jsonp"),i=require("./net/img"),n=window.location.protocol+"//p.qiao.baidu.com",exports={};return exports.ajax=function(i,o){if("jsonp"===o.type)if(-1!==i.indexOf("/smartBox/"))return t.request(i,o);else return t.request(n+i,o);if("post"===o.method)return e.post(i,o.data,o.onsuccess,o.onfail);else return e.get(i,o.data,o.onsuccess,o.onfail)},exports.img=function(e,o){if("jsonp"===o.type)return t.request(n+e,o);i.request(e,o.data,o.onsuccess,o.onfail)},exports}),function(){"use strict";function t(e){if(e)d[0]=d[16]=d[1]=d[2]=d[3]=d[4]=d[5]=d[6]=d[7]=d[8]=d[9]=d[10]=d[11]=d[12]=d[13]=d[14]=d[15]=0,this.blocks=d,this.buffer8=l;else if(a){var t=new ArrayBuffer(68);this.buffer8=new Uint8Array(t),this.blocks=new Uint32Array(t)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}var r="input is invalid type",e="object"==typeof window,i=e?window:{};i.JS_MD5_NO_WINDOW&&(e=!1);var s=!e&&"object"==typeof self,h=!i.JS_MD5_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;h?i=global:s&&(i=self);var f=!i.JS_MD5_NO_COMMON_JS&&"object"==typeof module&&module.exports,o="function"==typeof define&&define.amd,a=!i.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,n="0123456789abcdef".split(""),u=[128,32768,8388608,-2147483648],y=[0,8,16,24],c=["hex","array","digest","buffer","arrayBuffer","base64"],p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),d=[],l;if(a){var A=new ArrayBuffer(68);l=new Uint8Array(A),d=new Uint32Array(A)}!i.JS_MD5_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!a||!i.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});var b=function(e){return function(i){return new t(!0).update(i)[e]()}},v=function(){var e=b("hex");h&&(e=w(e)),e.create=function(){return new t},e.update=function(t){return e.create().update(t)};for(var i=0;i<c.length;++i){var n=c[i];e[n]=b(n)}return e},w=function(t){var e=eval("require('crypto')"),i=eval("require('buffer').Buffer"),s=function(n){if("string"==typeof n)return e.createHash("md5").update(n,"utf8").digest("hex");if(null===n||void 0===n)throw r;return n.constructor===ArrayBuffer&&(n=new Uint8Array(n)),Array.isArray(n)||ArrayBuffer.isView(n)||n.constructor===i?e.createHash("md5").update(new i(n)).digest("hex"):t(n)};return s};t.prototype.update=function(e){if(!this.finalized){var t,i=typeof e;if("string"!==i){if("object"!==i)throw r;if(null===e)throw r;if(a&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||a&&ArrayBuffer.isView(e)))throw r;t=!0}for(var n,o,s=0,c=e.length,u=this.blocks,l=this.buffer8;s<c;){if(this.hashed&&(this.hashed=!1,u[0]=u[16],u[16]=u[1]=u[2]=u[3]=u[4]=u[5]=u[6]=u[7]=u[8]=u[9]=u[10]=u[11]=u[12]=u[13]=u[14]=u[15]=0),t)if(a)for(o=this.start;s<c&&o<64;++s)l[o++]=e[s];else for(o=this.start;s<c&&o<64;++s)u[o>>2]|=e[s]<<y[3&o++];else if(a)for(o=this.start;s<c&&o<64;++s)(n=e.charCodeAt(s))<128?l[o++]=n:n<2048?(l[o++]=192|n>>6,l[o++]=128|63&n):n<55296||n>=57344?(l[o++]=224|n>>12,l[o++]=128|n>>6&63,l[o++]=128|63&n):(n=65536+((1023&n)<<10|1023&e.charCodeAt(++s)),l[o++]=240|n>>18,l[o++]=128|n>>12&63,l[o++]=128|n>>6&63,l[o++]=128|63&n);else for(o=this.start;s<c&&o<64;++s)(n=e.charCodeAt(s))<128?u[o>>2]|=n<<y[3&o++]:n<2048?(u[o>>2]|=(192|n>>6)<<y[3&o++],u[o>>2]|=(128|63&n)<<y[3&o++]):n<55296||n>=57344?(u[o>>2]|=(224|n>>12)<<y[3&o++],u[o>>2]|=(128|n>>6&63)<<y[3&o++],u[o>>2]|=(128|63&n)<<y[3&o++]):(n=65536+((1023&n)<<10|1023&e.charCodeAt(++s)),u[o>>2]|=(240|n>>18)<<y[3&o++],u[o>>2]|=(128|n>>12&63)<<y[3&o++],u[o>>2]|=(128|n>>6&63)<<y[3&o++],u[o>>2]|=(128|63&n)<<y[3&o++]);this.lastByteIndex=o,this.bytes+=o-this.start,o>=64?(this.start=o-64,this.hash(),this.hashed=!0):this.start=o}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},t.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[t>>2]|=u[3&t],t>=56&&(this.hashed||this.hash(),e[0]=e[16],e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.bytes<<3,e[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},t.prototype.hash=function(){var e,t,i,n,o,r,a=this.blocks;this.first?t=((t=((e=((e=a[0]-680876937)<<7|e>>>25)-271733879<<0)^(i=((i=(-271733879^(n=((n=(-1732584194^2004318071&e)+a[1]-117830708)<<12|n>>>20)+e<<0)&(-271733879^e))+a[2]-1126478375)<<17|i>>>15)+n<<0)&(n^e))+a[3]-1316259209)<<22|t>>>10)+i<<0:(e=this.h0,t=this.h1,i=this.h2,t=((t+=((e=((e+=((n=this.h3)^t&(i^n))+a[0]-680876936)<<7|e>>>25)+t<<0)^(i=((i+=(t^(n=((n+=(i^e&(t^i))+a[1]-389564586)<<12|n>>>20)+e<<0)&(e^t))+a[2]+606105819)<<17|i>>>15)+n<<0)&(n^e))+a[3]-1044525330)<<22|t>>>10)+i<<0),t=((t+=((e=((e+=(n^t&(i^n))+a[4]-176418897)<<7|e>>>25)+t<<0)^(i=((i+=(t^(n=((n+=(i^e&(t^i))+a[5]+1200080426)<<12|n>>>20)+e<<0)&(e^t))+a[6]-1473231341)<<17|i>>>15)+n<<0)&(n^e))+a[7]-45705983)<<22|t>>>10)+i<<0,t=((t+=((e=((e+=(n^t&(i^n))+a[8]+1770035416)<<7|e>>>25)+t<<0)^(i=((i+=(t^(n=((n+=(i^e&(t^i))+a[9]-1958414417)<<12|n>>>20)+e<<0)&(e^t))+a[10]-42063)<<17|i>>>15)+n<<0)&(n^e))+a[11]-1990404162)<<22|t>>>10)+i<<0,t=((t+=((e=((e+=(n^t&(i^n))+a[12]+1804603682)<<7|e>>>25)+t<<0)^(i=((i+=(t^(n=((n+=(i^e&(t^i))+a[13]-40341101)<<12|n>>>20)+e<<0)&(e^t))+a[14]-1502002290)<<17|i>>>15)+n<<0)&(n^e))+a[15]+1236535329)<<22|t>>>10)+i<<0,t=((t+=((n=((n+=(t^i&((e=((e+=(i^n&(t^i))+a[1]-165796510)<<5|e>>>27)+t<<0)^t))+a[6]-1069501632)<<9|n>>>23)+e<<0)^e&((i=((i+=(e^t&(n^e))+a[11]+643717713)<<14|i>>>18)+n<<0)^n))+a[0]-373897302)<<20|t>>>12)+i<<0,t=((t+=((n=((n+=(t^i&((e=((e+=(i^n&(t^i))+a[5]-701558691)<<5|e>>>27)+t<<0)^t))+a[10]+38016083)<<9|n>>>23)+e<<0)^e&((i=((i+=(e^t&(n^e))+a[15]-660478335)<<14|i>>>18)+n<<0)^n))+a[4]-405537848)<<20|t>>>12)+i<<0,t=((t+=((n=((n+=(t^i&((e=((e+=(i^n&(t^i))+a[9]+568446438)<<5|e>>>27)+t<<0)^t))+a[14]-1019803690)<<9|n>>>23)+e<<0)^e&((i=((i+=(e^t&(n^e))+a[3]-187363961)<<14|i>>>18)+n<<0)^n))+a[8]+1163531501)<<20|t>>>12)+i<<0,t=((t+=((n=((n+=(t^i&((e=((e+=(i^n&(t^i))+a[13]-1444681467)<<5|e>>>27)+t<<0)^t))+a[2]-51403784)<<9|n>>>23)+e<<0)^e&((i=((i+=(e^t&(n^e))+a[7]+1735328473)<<14|i>>>18)+n<<0)^n))+a[12]-1926607734)<<20|t>>>12)+i<<0,t=((t+=((r=(n=((n+=((o=t^i)^(e=((e+=(o^n)+a[5]-378558)<<4|e>>>28)+t<<0))+a[8]-2022574463)<<11|n>>>21)+e<<0)^e)^(i=((i+=(r^t)+a[11]+1839030562)<<16|i>>>16)+n<<0))+a[14]-35309556)<<23|t>>>9)+i<<0,t=((t+=((r=(n=((n+=((o=t^i)^(e=((e+=(o^n)+a[1]-1530992060)<<4|e>>>28)+t<<0))+a[4]+1272893353)<<11|n>>>21)+e<<0)^e)^(i=((i+=(r^t)+a[7]-155497632)<<16|i>>>16)+n<<0))+a[10]-1094730640)<<23|t>>>9)+i<<0,t=((t+=((r=(n=((n+=((o=t^i)^(e=((e+=(o^n)+a[13]+681279174)<<4|e>>>28)+t<<0))+a[0]-358537222)<<11|n>>>21)+e<<0)^e)^(i=((i+=(r^t)+a[3]-722521979)<<16|i>>>16)+n<<0))+a[6]+76029189)<<23|t>>>9)+i<<0,t=((t+=((r=(n=((n+=((o=t^i)^(e=((e+=(o^n)+a[9]-640364487)<<4|e>>>28)+t<<0))+a[12]-421815835)<<11|n>>>21)+e<<0)^e)^(i=((i+=(r^t)+a[15]+530742520)<<16|i>>>16)+n<<0))+a[2]-995338651)<<23|t>>>9)+i<<0,t=((t+=((n=((n+=(t^((e=((e+=(i^(t|~n))+a[0]-198630844)<<6|e>>>26)+t<<0)|~i))+a[7]+1126891415)<<10|n>>>22)+e<<0)^((i=((i+=(e^(n|~t))+a[14]-1416354905)<<15|i>>>17)+n<<0)|~e))+a[5]-57434055)<<21|t>>>11)+i<<0,t=((t+=((n=((n+=(t^((e=((e+=(i^(t|~n))+a[12]+1700485571)<<6|e>>>26)+t<<0)|~i))+a[3]-1894986606)<<10|n>>>22)+e<<0)^((i=((i+=(e^(n|~t))+a[10]-1051523)<<15|i>>>17)+n<<0)|~e))+a[1]-2054922799)<<21|t>>>11)+i<<0,t=((t+=((n=((n+=(t^((e=((e+=(i^(t|~n))+a[8]+1873313359)<<6|e>>>26)+t<<0)|~i))+a[15]-30611744)<<10|n>>>22)+e<<0)^((i=((i+=(e^(n|~t))+a[6]-1560198380)<<15|i>>>17)+n<<0)|~e))+a[13]+1309151649)<<21|t>>>11)+i<<0,t=((t+=((n=((n+=(t^((e=((e+=(i^(t|~n))+a[4]-145523070)<<6|e>>>26)+t<<0)|~i))+a[11]-1120210379)<<10|n>>>22)+e<<0)^((i=((i+=(e^(n|~t))+a[2]+718787259)<<15|i>>>17)+n<<0)|~e))+a[9]-343485551)<<21|t>>>11)+i<<0,this.first?(this.h0=e+1732584193<<0,this.h1=t-271733879<<0,this.h2=i-1732584194<<0,this.h3=n+271733878<<0,this.first=!1):(this.h0=this.h0+e<<0,this.h1=this.h1+t<<0,this.h2=this.h2+i<<0,this.h3=this.h3+n<<0)},t.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,i=this.h2,o=this.h3;return n[e>>4&15]+n[15&e]+n[e>>12&15]+n[e>>8&15]+n[e>>20&15]+n[e>>16&15]+n[e>>28&15]+n[e>>24&15]+n[t>>4&15]+n[15&t]+n[t>>12&15]+n[t>>8&15]+n[t>>20&15]+n[t>>16&15]+n[t>>28&15]+n[t>>24&15]+n[i>>4&15]+n[15&i]+n[i>>12&15]+n[i>>8&15]+n[i>>20&15]+n[i>>16&15]+n[i>>28&15]+n[i>>24&15]+n[o>>4&15]+n[15&o]+n[o>>12&15]+n[o>>8&15]+n[o>>20&15]+n[o>>16&15]+n[o>>28&15]+n[o>>24&15]},t.prototype.toString=t.prototype.hex,t.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,i=this.h2,n=this.h3;return[255&e,e>>8&255,e>>16&255,e>>24&255,255&t,t>>8&255,t>>16&255,t>>24&255,255&i,i>>8&255,i>>16&255,i>>24&255,255&n,n>>8&255,n>>16&255,n>>24&255]},t.prototype.array=t.prototype.digest,t.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(16),t=new Uint32Array(e);return t[0]=this.h0,t[1]=this.h1,t[2]=this.h2,t[3]=this.h3,e},t.prototype.buffer=t.prototype.arrayBuffer,t.prototype.base64=function(){for(var e,t,i,n="",o=this.array(),r=0;r<15;)e=o[r++],t=o[r++],i=o[r++],n+=p[e>>>2]+p[63&(e<<4|t>>>4)]+p[63&(t<<2|i>>>6)]+p[63&i];return e=o[r],n+=p[e>>>2]+p[e<<4&63]+"=="};var _=v();f?module.exports=_:(i.md5=_,o&&define("embed/mobilelite/lib/md5.min",[],function(){return _}))}(),define("embed/invite/mobile/smartyInvite",["require","../../mobilelite/lib/ajax","../../mobilelite/lib/md5.min"],function(require){function e(){var e;if(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i.test(navigator.userAgent))e=2;else e=1;return e}function t(){if(""===(h=document.referrer))return!1;var e=["www.baidu.com","www.so.com","www.sogou.com","m.sm.cn"],t=h.split("/")[2];if(-1!==e.indexOf(t))return!0;else return!1}function i(e,t){var i=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=t.match(i);if(null!=n)return decodeURIComponent(n[2]);else return null}function n(){if(!t())return v="";var e=h.split("/")[2],n=h.split("?")[1];if("www.baidu.com"===e)return v=i("word",n),b=i("eqid",n),v||b||"";else if("www.so.com"===e)return(v=i("q",n))||"";else if("www.sogou.com"===e)return(v=i("query",n))||"";else if("m.sm.cn"===e)return(v=i("q",n))||"";return""}function o(){var e=h;if(t()){if(0===e.indexOf("https://www.baidu.com")){var i="",n="",o=e.indexOf("url");if(-1!==o){i=e.slice(0,o);var r=e.indexOf("&",o);if(-1!==r)n=e.slice(r+1);e=i+n}}return e}return e}function r(){var e=new Date,t=e.getFullYear(),i=e.getMonth()+1;i=i<10?"0"+i:i;var n=e.getDate();n=n<10?"0"+n:n;var o=e.getHours();return o=o<10?"0"+o:o,T(t+i+n+o)}function a(e,t){var i=e+"=",n="";if(document.cookie.length>0){var o=document.cookie.indexOf(i);if(o>-1){o+=i.length;var r=document.cookie.indexOf(";",o);if(-1===r)r=document.cookie.length;n=t?unescape(document.cookie.substring(o,r)):document.cookie.substring(o,r)}}return n}function s(t,i,n,s,c,u){var l=(c.stayTime,{query:n,title:"",creative:"",ucid:u.userId,trade:c.tradeId,siteid:u.siteId,baiduid:a("BAIDUID"),bid:t.bid,refer:o()});if(l.time=(new Date).getTime(),l.token=r(),l.device=e(),s)l.sublink=s;var f={data:l,type:"jsonp",timeout:5e3,onsuccess:function(e){if(0==+e.status){if(e=e.data,e.startObj)i.smartInvite.startObj=e.startObj,exports.ideaType=e.startObj.type||-1,i.smartInvite.query=e.startObj.query||-1;if(exports.isHasSmartAccess=e.isOpen?1:0,e.isOpen)exports.isUseSmartyInvite=1,exports.isHideInvite=0,S=e.smartText||[];else{p(i,1)}}exports.isFininshGetPoint=1,exports.setFinshAccessAndWise()},onfail:function(e){exports.isFininshGetPoint=1,exports.setFinshAccessAndWise()}};w.ajax("/smartbox/wise/query",f)}function c(e){return 0!==e.seekIcon.width&&0!==e.seekIcon.height}function u(e){var t=e.toolbar.iconOrder;C=0;for(var i=0;i<t.length;i++)if(1===t[i].enable)if(C++,"onlineConsult"===t[i].type)O=C-1;return"1"===e.toolbar.enable&&-1!==O}function l(e){if(1===e.isFixedPosition)return-1===e.position.indexOf("top");var t=document.documentElement.clientWidth,i=document.documentElement.clientHeight,n=t*e.width*.01,o=i*e.height*.01;if(1===e.skinIndex||3===e.skinIndex||4===e.skinIndex)o=n;return e.marginTop>i/2-.5*o}function f(e){if(1===e.isFixedPosition)return-1!==e.position.indexOf("right");else return e.marginLeft>window.innerWidth/2}function d(e,t,i,n){return i+":"+e+"px;"+n+":"+t+"px;"}function m(e){var t=e.seekIcon;k="";var i=1*t.marginLeft,n=1*t.marginTop,o=document.documentElement.clientWidth,r=document.documentElement.clientHeight,a=o*t.width*.01,s=r*t.height*.01,c="left",u="top";if(1===t.skinIndex||3===t.skinIndex||4===t.skinIndex)s=a;if(1===t.isFixedPosition){if(k=t.position)var l=k.split("-");if("center"===l[1])i=5,n=.5*s,x=l[0]+":5px;top:50%;margin-top:-"+n+"px;",A=l[0]+":"+(a/2-16)+"px";else i=5,n=5+s,c=l[0],u=l[1],x=d(i,n,c,u),A=c+":"+(a/2-16)+"px"}else{var f=i+a/2;if(a+i>o)i=20,c="right";else if(f<.55*o)c="left";else i=o-i-a,c="right";if(s+n>r)n=s+20,u="bottom";else if(n>.5*r-.5*s)u="bottom",n=r-n;else n=1*t.marginTop+s;if(x=d(i,n,c,u),A=c+":"+(a/2-16)+"px;",f>.45*o&&f<.55*o)k="center",i+=.5*a,x=d(i,n,c,u),A="left:50%;margin-left:-16px"}}function g(e){e.stayTime=+e.stayTime,e.inviteInterval=+e.inviteInterval,e.closeTime=+e.closeTime}function p(e,t){e.logStopSmartInvite(t)}var exports={},h="",v="",b="",y="",I=0,w=require("../../mobilelite/lib/ajax"),T=require("../../mobilelite/lib/md5.min"),S=[],k="",E="",x="",C=0,O=-1,A=0;return exports.getExpGroupId=function(){return I},exports.hasShowInvite=0,exports.isFininshGetPoint=0,exports.ideaType=-1,exports.isHasSmartAccess=0,exports.isFinshGetSmartAccessWise=0,exports.isFinshGetShowTime=0,exports.abtestShowTimeObj={},exports.isShowInIconUp=!1,exports.isUseSmartyInvite=0,exports.setFinshAccessAndWise=function(e,t){exports.isFinshGetShowTime=1,exports.isFinshGetSmartAccessWise=1,e.renderMobileHtml()},exports.init=function(e,t,o){var r=e.getServer(),a=r.configBox,d=r.siteObj;g(a.inviteBox);var v;if(1!==a.inviteBox.smartBoxEnable||0===a.inviteBox.smartBoxOpen||0===a.inviteBox.autoInvite){if(1!==a.inviteBox.smartBoxEnable)v=3;else if(0===a.inviteBox.smartBoxOpen)v=4;else if(0===a.inviteBox.autoInvite)v=5;return p(t,v),exports.setFinshAccessAndWise(),!1}var b=c(a),I=u(a);if(b)m(a),exports.isShowInIconUp=l(a.seekIcon),exports.isShowRight=f(a.seekIcon),exports.isShowWithIcon=1;else if(I){if(exports.isShowWithToolbar=1,a.toolbar.bottomDistance<50)exports.isShowInIconUp=!0}else return v=6,p(t,v),exports.setFinshAccessAndWise(),!1;var w=n();y=i("link",h),s(o,t,w,y,a.inviteBox,d)},exports.getSmartInviteClass=function(){if(1===exports.isShowWithToolbar)return"nb-invite-wrap-smartInvite-"+C+"-"+O;else return"nb-invite-wrap-smartInvite-"+k},exports.hideInvite=function(e){exports.isHideInvite=1},exports.getSmartInviteText=function(e){if(S.length>0){var t=Math.floor(Math.random()*S.length);return S[t]}return"\u6b22\u8fce\u60a8\u6765\u54a8\u8be2"},exports.updateWelcomText=function(e,t,i,n,o){if(1===this.isUseSmartyInvite&&1===this.isHasSmartAccess){exports.hasShowInvite=1;var r=this.getSmartInviteText(n),a=r;if(-1!==a.indexOf('"')&&S.length>0){var s=a.match(/".*?"/)[0],c=a.split(s),u='<ins class="nb-invite-point">'+s+"</ins>";a=c[0]+u+c[1]}if(n.smartBaseSetting&&n.smartBaseSetting.welcome&&""!==exports.smartBackImg)a=n.smartBaseSetting.welcome.replace("\u60a8\u662f\u5426\u60f3\u54a8\u8be2\u5173\u4e8e“xxx”\u76f8\u5173\u7684\u5185\u5bb9\uff1f",a);E=r;var l=document.querySelector(".nb-smartInvite-text");if(l)l.innerHTML=a;if(i.smartInvite.text=r,0!==o.getServer("configBox").webim.isMobileWebim&&!t.isIos)r=r.replace(/"/g,'\\"');if(e.adata)e.adata.IntelligentInviteMsg=r;else e.adata={IntelligentInviteMsg:r}}},exports.getNowWelcomText=function(){return E},exports.getAdata=function(){return{IntelligentInviteMsg:E}},exports.getPosition=function(){return{invite:x,arrow:A}},exports}),define("embed/invite/mobile/inviteMMain",["require"],function(require){function e(e,i,n){clearTimeout(t);var o=0;if("show"===e){if(o=+i.closeTime,i.autoHide===n.ALLOWAUTOHIDE&&!isNaN(o)&&i.closeTime>=0)t=setTimeout(function(){exports.inviteWindowSwitch("off")},1e3*o)}else if("hide"===e)if(i.reInvite===n.ALLOWREINVITE&&"number"==typeof i.inviteInterval&&i.inviteInterval>=0)o=i.inviteInterval,t=setTimeout(function(){exports.inviteWindowSwitch("on")},1e3*o)}var t,exports={},i={startPage:0,stayTime:6,reInvite:1,inviteInterval:20,autoHide:0,closeTime:20},n={},o=function(e){if("string"!=typeof e)return"";var t=document.createElement("a");return t.href=e,t.hostname};return exports.delayToShow=function(e,t,n,o){var r=n.getServer("configBox").inviteBox,a=r.stayTime;if(0==+r.likeCrm){if(-1!=+o.abtestShowTimeObj.type&&0!=+o.abtestShowTimeObj.type&&void 0!==o.abtestShowTimeObj.type)a=o.abtestShowTimeObj.value}else if(1==+r.abtest&&1==+o.isUseSmartyInvite&&1==+o.isHasSmartAccess)a=i.stayTime;if("number"!=typeof a||a<0)a=0;else a*=1e3;e.set(t.INVITECOOKIENAME,location.hostname,{path:"/"}),e.set(t.INVITESTARTPAGECOOKIE,location.href,{path:"/"}),setTimeout(function(){exports.inviteWindowSwitch("on")},a)},exports.inviteWindowGuard=function(e,t,i,r){var a=t.getServer("configBox").inviteBox,s=!1;if(a.autoInvite===e.AUTOINVITEON){if(1==+a.abtest&&1==+r.isUseSmartyInvite&&1==+r.isHasSmartAccess)n.startPage=a.startPage,n.stayTime=a.stayTime,n.reInvite=a.reInvite,n.inviteInterval=a.inviteInterval,n.autoHide=a.autoHide,n.closeTime=a.closeTime;if(+a.startPage===e.ALLPAGE)s=!0;if(+a.startPage===e.ONLYSTARTPAGE){var c=i.get(e.INVITESTARTPAGECOOKIE);if(!c)s=!0;else if(c===location.href)s=!0;else if(document.referrer){var u=o(document.referrer);if(u!==location.hostname)s=!0}else{var l=i.get(e.INVITECOOKIENAME);if(l){if(l!==location.hostname)s=!0}else s=!0}}if(s&&1==+r.isFinshGetSmartAccessWise&&1==+r.isFinshGetShowTime)exports.delayToShow()}},exports.inviteWindowSwitch=function(t,n,o,r,a,s,c){var u=o.getServer("configBox").inviteBox;if(1!==r.isHideInvite||2===a.fromType){var l=n.WRAPID,f=0;if(1===r.isUseSmartyInvite&&2!==a.fromType&&1===r.isHasSmartAccess){if(l=n.WRAPIDSMART,1==+u.abtest)l=n.WRAPIDSMARTAbtest,u.stayTime=i.stayTime,u.reInvite=i.reInvite,u.inviteInterval=i.inviteInterval,u.autoHide=i.autoHide,u.closeTime=i.closeTime;f=1}if("on"===c)r.updateWelcomText(u,o);if("on"===c&&1===r.isUseSmartyInvite&&0===r.isFininshGetPoint&&1===r.isHasSmartAccess)return void setTimeout(function(){if(s.smartInvite.ideaType=r.ideaType,s.logInviteShow(f,a.fromType),r.updateWelcomText(u,o),t.show([l]),u.autoHide===n.ALLOWAUTOHIDE)e("show",u,n)},2e3);if("on"===c){if(s.smartInvite.ideaType=r.ideaType,t.show([l]),s.logInviteShow(f,a.fromType),u.autoHide===n.ALLOWAUTOHIDE)e("show",u,n)}else if("off"===c)if(t.hide([l]),u.reInvite===n.ALLOWREINVITE&&u.autoInvite===n.AUTOINVITEON)e("hide",u,n)}},exports.showInvite=function(e,t,i){i.timeKey=setTimeout(function(){t.show("nb_invite_wrap")},e.SHOWINTERVAL)},exports.process=function(){},exports.renderHTML=function(e,t,i,n,o){var r=t.getWrap(),a=i.getInviteStyle(),s=o.template(n,a);e.appendHTML(s,r)},exports.init=function(e){exports.renderHTML(),e.init()},exports}),define("embed/invite/mobile/inviteMobileHandler",["require"],function(require){var exports={};return exports.acceptInvite=function(e,t,i,n){i.logClickInvite(n.fromType),e.accept(1),t.inviteWindowSwitch("off")},exports.refuseInvite=function(e,t,i){if(2===e.fromType)t.refuse();i.inviteWindowSwitch("off")},exports.getClickEle=function(e){return[e.PREFIXID+"ok",e.PREFIXID+"abtest_ok",e.PREFIXIDSMART+"ok"]},exports.process=function(e){e.inviteWindowGuard()},exports.accessSet=function(e,t,i,n){e.logClickSmartLogo();var o=t.getServer(),r=o.siteObj;window.location.href="http:"+r.webRoot+"web/smart_access.html?webRoot="+r.webRoot+"&siteId="+r.siteId+"&bid="+i.bid},exports}),define("embed/invite/mobile/inviteMobile.tpl",[],function(){return'\x3c!-- target: invitebox --\x3e<% if (data.hasOwnProperty(\'smartInvite\')) { %><% if (+data.abtest === 1) { %><ins class="nb-invite-wrap-base nb-invite-wrap-0 nb-invite-wrap-abtest" id="nb_invite_abtest_wrap" style="height:<%heightPxAbtext%>px;display:none;"><ins class="nb-invite-tool-base nb-invite-tool" id="nb_invite_tool">×</ins><ins class="nb-invite-body-base nb-invite-body"><ins class="nb-invite-welcom nb-smartInvite-text">\u4f60\u662f\u60f3\u54a8\u8be2\u300e<%smartInvite.query%>\u300f\u7684\u95ee\u9898\u5417\uff1f<ins class="nb-invite-point"></ins></ins><ins class="nb-invite-btns"><ins class="nb-invite-ok" id="nb_invite_abtest_ok">\u73b0\u5728\u54a8\u8be2</ins><ins class="nb-invite-no" id="nb_invite_abtest_cancel">\u7a0d\u540e\u518d\u8bf4</ins></ins></ins></ins><% } else { %><ins class="nb-invite-wrap-smartInvite<% if (data.isShowInIconUp) { %> nb-invite-wrap-smartInvite-up<% } %> <% if (data.isShowRight) { %> nb-invite-wrap-smartInvite-right<% } %> <% smartInviteClass %>" id="nb_invite_smart_wrap" <% if (data.smartPosition.invite) { %>style="<% smartPosition.invite %>" <% } %> ><% if (+data.likeCrm === 0) { %><ins class="nb-invite-wrap-smartInvite-body-lks"><ins class="nb-invite-tool-base nb-invite-tool-base-smartInvite-lks nb-invite-tool" id="nb_invite_smart_cancel"></ins><ins class="nb-invite-tool-logo" style="" id="nb_invite_logo"></ins><ins class="nb-smartInvite-text nb-smartInvite-text-lks" id="nb_invite_smart_ok">\u4f60\u662f\u60f3\u54a8\u8be2\u300e<%smartInvite.query%>\u300f\u7684\u95ee\u9898\u5417\uff1f</ins><ins class="<% if (data.isShowInIconUp) { %>nb-smartInvite-arrow-down-lks<% } else { %>nb-smartInvite-arrow-lks<% } %>" style="<% smartPosition.arrow %>"></ins><% } else { %><ins class="nb-invite-wrap-smartInvite-body"><ins class="nb-invite-tool-base nb-invite-tool-base-smartInvite nb-invite-tool" id="nb_invite_smart_cancel">×</ins><ins class="nb-smartInvite-text" id="nb_invite_smart_ok">\u4f60\u662f\u60f3\u54a8\u8be2\u300e<%smartInvite.query%>\u300f\u7684\u95ee\u9898\u5417\uff1f</ins><ins class="<% if (data.isShowInIconUp) { %>nb-smartInvite-arrow-down<% } else { %>nb-smartInvite-arrow<% } %>" style="<% smartPosition.arrow %>"></ins><% } %></ins></ins><% } %><% } %><% if (data.hasOwnProperty(\'customerStylePro\') && +data.customerStylePro.isInviteFixed === 0) { %><% if (data.isCustomerStyle) { %><ins class="nb-invite-wrap-base nb-invite-wrap-<%skinIndex%> nb-invite-custom" id="nb_invite_wrap" style="height:<%heightPx%>px;width:<%width%>%;display:none;background-image:url(<%backImg%>);left:<%customerStylePro.inviteLeft%>px;top:<%customerStylePro.inviteTop%>px;"><% } else { %><ins class="nb-invite-wrap-base nb-invite-wrap-<%skinIndex%>" id="nb_invite_wrap" style="height:<%heightPx%>px;width:<%width%>%;display:none;left:<%customerStylePro.inviteLeft%>px;top:<%customerStylePro.inviteTop%>px;"><% } %><% } else { %><% if (data.isCustomerStyle) { %><% if (data.position === \'middle\') { %><ins class="nb-invite-wrap-base nb-invite-wrap-<%skinIndex%> nb-invite-custom mobile-invite-<%position%>" id="nb_invite_wrap" style="min-height:<%heightPx%>px;width:<%width%>%;display:none;background-image:url(<%backImg%>)"><% } else { %><ins class="nb-invite-wrap-base nb-invite-wrap-<%skinIndex%> nb-invite-custom mobile-invite-<%position%>" id="nb_invite_wrap" style="min-height:<%heightPx%>px;display:none;background-image:url(<%backImg%>)"><% } %><% } else { %><% if (data.position === \'middle\') { %><ins class="nb-invite-wrap-base nb-invite-wrap-<%skinIndex%> mobile-invite-<%position%>" id="nb_invite_wrap" style="min-height:<%heightPx%>px;width:<%width%>%;display:none;"><% } else { %><ins class="nb-invite-wrap-base nb-invite-wrap-<%skinIndex%> mobile-invite-<%position%>" id="nb_invite_wrap" style="min-height:<%heightPx%>px;display:none;"><% } %><% } %><% } %>\x3c!-- // = 3 \u4e3a\u9ad8\u7ea7\u5b9a\u5236 --\x3e<% if (+data.isCustomerStyle === 3) {%><% if (+data.customerStylePro.isShowCloseBtn === 1) {%><ins class="blank-talk-style" id="nb_invite_tool" style="width:<%customerStylePro.closeBtnStyle.width%>;height:<%customerStylePro.closeBtnStyle.height%>;position: absolute;top:<%customerStylePro.closeBtnStyle.y%>;left:<%customerStylePro.closeBtnStyle.x%>;z-index:1;"></ins><% } %><% if (+data.customerStylePro.isShowLaterBtn === 1) {%><ins class="blank-talk-style" id="nb_invite_cancel"style="width:<%customerStylePro.laterBtnStyle.width%>;height:<%customerStylePro.laterBtnStyle.height%>;position: absolute;top:<%customerStylePro.laterBtnStyle.y%>;left:<%customerStylePro.laterBtnStyle.x%>;z-index:2;"></ins><% } %><% if (+data.customerStylePro.isShowConsultBtn === 1) {%><ins class="blank-talk-style" id="nb_invite_ok" style="width:<%customerStylePro.consultBtnStyle.width%>;height:<%customerStylePro.consultBtnStyle.height%>;position: absolute;top:<%customerStylePro.consultBtnStyle.y%>;left:<%customerStylePro.consultBtnStyle.x%>;z-index:3;"></ins><% } %><% } else { %><ins class="nb-invite-tool-base nb-invite-tool" id="nb_invite_tool">×</ins><ins class="nb-invite-body-base nb-invite-body"><ins class="nb-invite-welcom <%isShowText%>"><%welcome%></ins><ins class="nb-invite-btns"><% if (data.isCustomerStyle) { %><ins class="nb-invite-ok" id="nb_invite_ok" style="background-color:<%customerStyle.acceptBgColor%>;color:<%customerStyle.acceptFontColor%>">\u73b0\u5728\u54a8\u8be2</ins><% } else { %><ins class="nb-invite-ok" id="nb_invite_ok">\u73b0\u5728\u54a8\u8be2</ins><% } %><ins class="nb-invite-no" id="nb_invite_cancel">\u7a0d\u540e\u518d\u8bf4</ins></ins></ins><% } %></ins>\x3c!-- end --\x3e'}),define("embed/invite/mobile/inviteMobileData",["require"],function(require){var exports={},e=1;return exports.dataProcess=function(t,i,n,o){if(1===e)e+=1,n.init();var r=i.extend({},o);if(1===n.isUseSmartyInvite&&1===n.isHasSmartAccess)r.smartInvite=1,r.isShowInIconUp=n.isShowInIconUp,r.isShowRight=n.isShowRight,r.smartInviteClass=n.getSmartInviteClass(),r.smartPosition=n.getPosition();if(o.hasOwnProperty("customerStylePro")&&0===o.customerStylePro.isInviteFixed){var a=parseInt(o.customerStylePro.inviteLeft,10),s=parseInt(o.customerStylePro.inviteTop,10);a=a>document.documentElement.clientWidth*(1-.01*o.width)?document.documentElement.clientWidth*(1-.01*o.width):a,a=a<0?0:a,s=s>document.documentElement.clientHeight*(1-.01*o.height)?document.documentElement.clientHeight*(1-.01*o.height):s,s=s<0?0:s,r.customerStylePro.inviteLeft=a,r.customerStylePro.inviteTop=s}if(o.isCustomerStyle)r.inviteClass="nb-invite-custom";else r.inviteClass=t.SKINPRE+o.skinIndex;if(3===r.isCustomerStyle)r.backImg=r.customerStylePro.bgImgUrl;else if(r.customerStyle&&r.customerStyle.backImg)r.backImg=r.customerStyle.backImg;return r.isShowText=["nb-hide","nb-show"][+o.isShowText],r.heightPx=.01*window.innerHeight*r.height,r.heightPxAbtext=.01*window.innerHeight*20,r},exports}),define("embed/invite/mobile/inviteMobileConsts",[],function(){return{SHOWINTERVAL:2e3,AUTOINVITEON:1,AUTOINVITEOFF:0,ONLYSTARTPAGE:0,ALLPAGE:1,ALLOWREINVITE:1,DENYREINVITE:0,ALLOWAUTOHIDE:1,DENYAUTOHIDE:0,INVITECOOKIENAME:"nb-referrer-hostname",INVITESTARTPAGECOOKIE:"nb-start-page-url",PREFIXID:"nb_invite_",PREFIXIDSMART:"nb_invite_smart_",WRAPID:"nb_invite_wrap",WRAPIDSMART:"nb_invite_smart_wrap",WRAPIDSMARTAbtest:"nb_invite_abtest_wrap",SKINPRE:"nb-invite-wrap-"}}),define("embed/invite/inviteMConfig",["require","./inviteMain","./inviteData","./inviteHandler","./mobile/smartyInvite","./mobile/inviteMMain","./mobile/inviteMobileHandler","./mobile/inviteMobile.tpl","./mobile/inviteMobileData","./mobile/inviteMobileConsts"],function(require){return{package:"minvite",resource:{main:require("./inviteMain"),data:require("./inviteData"),handler:require("./inviteHandler"),smartyInvite:require("./mobile/smartyInvite"),mmain:require("./mobile/inviteMMain"),mhandler:require("./mobile/inviteMobileHandler"),tpl:require("./mobile/inviteMobile.tpl"),mdata:require("./mobile/inviteMobileData"),consts:require("./mobile/inviteMobileConsts")},injection:[{id:"minvite.main",method:{init:["minvite.handler"],renderHtml:["mbase.dom","common.view","minvite.data","common.util","minvite.tpl","minvite.mmain","minvite.smartyInvite"],renderMobileHtml:["mbase.dom","common.view","minvite.data","common.util","minvite.tpl","minvite.mmain","minvite.smartyInvite"],renderHtml2:["minvite.handler"]}},{id:"minvite.data",method:{getInviteStyle:["data.config","minvite.mdata"]}},{id:"minvite.handler",method:{bindEvent:["mbase.events","minvite.consts","minvite.mhandler"]}},{id:"minvite.mmain",method:{init:["minvite.mhandler"],renderHTML:["mbase.dom","common.view","minvite.mdata","minvite.tpl","common.util"],showInvite:["minvite.mdata","mbase.dom"],inviteWindowGuard:["minvite.consts","data.config","common.cookie","minvite.smartyInvite"],delayToShow:["common.cookie","minvite.consts","data.config","minvite.smartyInvite"],inviteWindowSwitch:["mbase.dom","minvite.consts","data.config","minvite.smartyInvite","core.config","log.main"]}},{id:"minvite.mdata",method:{dataProcess:["minvite.consts","mbase.lib","minvite.smartyInvite"]}},{id:"minvite.mhandler",method:{bindEvent:["mbase.events","minvite.mhandler","minvite.consts","minvite.mmain"],acceptInvite:["mchat.chat","minvite.mmain","log.main","core.config"],refuseInvite:["core.config","mchat.chat","minvite.mmain"],getClickEle:["minvite.consts"],process:["minvite.mmain"],accessSet:["log.main","data.config","core.config"]}},{id:"minvite.smartyInvite",method:{init:["data.config","log.main","core.config"],updateWelcomText:["core.config","mbase.brower","log.main"],hideInvie:["minvite.mmain"],setFinshAccessAndWise:["minvite.main"],getSmartAccess:["log.main","data.config","core.config"]}}],aspect:[{id:"minvite.main",pointCut:["micon.main.init, , init"]}]}}),define("embed/icon/iconMain",["require"],function(require){var exports={};return exports.renderHtml=function(e,t,i,n,o,r){var a=e.getIconTplData(),s=i.template(t,a);n.appendHTML(s,o.getWrap()),r.componentIsShow.icon=1},exports.init=function(e,t){var i=t.getServer("configBox").seekIcon;if(0!=+i.width&&0!=+i.height)exports.renderHtml(),e.init()},exports}),define("embed/icon/iconHandler",["require"],function(require){var exports={};return exports.handleAccept=function(e,t){e.clickIcon(t)},exports.bindEvent=function(e,t){e.domOn("nb_icon_wrap","click",exports.handleAccept,!1),t.bindEvent()},exports.init=function(){exports.bindEvent()},exports}),define("embed/icon/iconData",["require"],function(require){var exports={};return exports.getIconTplData=function(e,t){var i=e.getServer("configBox").seekIcon,n=t.dataProcess(i);if(1==+i.isCustomerStyle)n.backImg="background-image: url("+n.customerStyle.backImg+");";return n},exports}),define("embed/icon/mobile/iconMobileData",["require"],function(require){function e(e,t,i,n,o){var r={};switch(e){case"flag":var a=0;if("right-center"===t||"left-center"===t)a=n-Math.ceil(n/2);else a=n;if(o.isBDBox)a-=1;r.flagPosition="margin-top:"+a+"px",r.borderLeftWidth=Math.ceil(i/2)+"vw",r.borderRightWidth=i-parseInt(r.borderLeftWidth,10)+"vw";break;default:r={}}return r}function t(e){var t=+e.width,i=+e.height,n=+e.marginTop,o=+e.marginLeft,r=document.documentElement.clientWidth,a=document.documentElement.clientHeight;if(1===e.skinIndex||3===e.skinIndex||4===e.skinIndex){var s=t*r*.01;e.height=s,e.width=s}if(.01*t*r+o>r)e.horizontalAttr="right",e.horizontalPixel=20,e.marginLeft=r-.01*t*r-20;else e.horizontalAttr="left",e.horizontalPixel=o;if(.01*i*a+n>a)e.verticalAttr="bottom",e.verticalPixel=20,e.marginTop=a-.01*i*a-20;else e.verticalAttr="top",e.verticalPixel=n;var c=window.innerWidth*(1-.01*t)-o;e.marginRight=c,e.leftOrRight=c<o?"right":"left"}var exports={};return exports.dataProcess=function(i,n,o){var r=i.extend({},o),a=["","circle","flag","sector","circle","flag"][o.skinIndex];return r.shape=e(a,o.position,o.width,o.height,n),t(r),r},exports}),define("embed/icon/mobile/iconMobile.tpl",[],function(){return'\x3c!-- target: iconicon --\x3e<% if (data.isFixedPosition == 1) { %><% if (data.skinIndex == 1 || data.skinIndex == 3 || data.skinIndex == 4) { %><ins id="nb_icon_wrap" class="nb-icon-wrap nb-icon-<%position%> nb-icon-wrap-<%skinIndex%>" style="height:<%height%>px;width:<%width%>px;"><% } else { %><ins id="nb_icon_wrap" class="nb-icon-wrap nb-icon-<%position%> nb-icon-wrap-<%skinIndex%>" style="height:<%height%>%;width:<%width%>%;"><% } %><% if (data.isCustomerStyle == 1) { %><ins class="nb-icon-wrap-base nb-icon-customer" style="background-image:url(<%customerStyle.backImg%>);"></ins><% } else { %><ins class="nb-icon-wrap-base nb-icon-wrap-<%skinIndex%>-<%position%>"></ins><% if (data.skinIndex == 2 || data.skinIndex == 5) { %><ins style="border-left-width: <%shape.borderLeftWidth%>;border-right-width: <%shape.borderRightWidth%>;" class="nb-icon-flag nb-icon-flag-<%skinIndex%>"></ins><% } %><% } %></ins><% } else { %><% if (data.skinIndex == 1 || data.skinIndex == 3 || data.skinIndex == 4) { %><ins id="nb_icon_wrap" class="nb-icon-wrap nb-icon-wrap-<%skinIndex%>" style="height:<%height%>px;width:<%width%>px;;left:<%marginLeft%>px;top:<%marginTop%>px;"><% } else { %><ins id="nb_icon_wrap" class="nb-icon-wrap nb-icon-wrap-<%skinIndex%>" style="height:<%height%>%;width:<%width%>%;;left:<%marginLeft%>px;top:<%marginTop%>px;"><% } %><% if (data.isCustomerStyle == 1) { %><ins class="nb-icon-wrap-base nb-icon-customer" style="background-image:url(<%customerStyle.backImg%>);"></ins><% } else { %><ins class="nb-icon-wrap-base nb-icon-wrap-<%skinIndex%>-<%leftOrRight%>"></ins><% if (data.skinIndex == 2 || data.skinIndex == 5) { %><ins style="border-left-width: <%shape.borderLeftWidth%>;border-right-width: <%shape.borderRightWidth%>;" class="nb-icon-flag nb-icon-flag-<%skinIndex%>"></ins><% } %><% } %></ins><% } %>'}),define("embed/icon/mobile/iconMobileHandler",["require"],function(require){var exports={};return exports.bindEvent=function(e,t){},exports.clickIcon=function(e,t,i){i.logClickIcon(),e.accept(0),t.hide(["nb_invite_wrap"])},exports}),define("embed/icon/mobile/iconMobileConsts",[],function(){return{PREFIXID:"nb_icon_"}}),define("embed/icon/iconMConfig",["require","./iconMain","./iconHandler","./iconData","./mobile/iconMobileData","./mobile/iconMobile.tpl","./mobile/iconMobileHandler","./mobile/iconMobileConsts"],function(require){return{package:"micon",resource:{main:require("./iconMain"),handler:require("./iconHandler"),data:require("./iconData"),mdata:require("./mobile/iconMobileData"),tpl:require("./mobile/iconMobile.tpl"),phandler:require("./mobile/iconMobileHandler"),consts:require("./mobile/iconMobileConsts")},injection:[{id:"micon.phandler",method:{bindEvent:["mbase.events","micon.consts","micon.phandler"],clickIcon:["mchat.chat","mbase.dom","log.main"],handleMouse:["micon.consts","mbase.events"]}},{id:"micon.mdata",method:{dataProcess:["mbase.lib","mbase.brower"]}},{id:"micon.main",method:{init:["micon.handler","data.config"]}},{id:"micon.main",method:{renderHtml:["micon.data","micon.tpl","common.util","mbase.dom","common.view","log.main"]}},{id:"micon.data",method:{getIconTplData:["data.config","micon.mdata"]}},{id:"micon.handler",method:{bindEvent:["mbase.events","micon.phandler"],handleAccept:["micon.phandler"]}}],aspect:[{id:"micon.main",pointCut:["toolbar.main.init, , init"]}]}}),define("base/pc/lib",["require"],function(require){function e(e,t){var i="",n=e<0,o=Math.abs(e)+"";if(o.length<t)i=new Array(t-o.length+1).join("0");return(n?"-":"")+i+o}var exports={},t=/\{\s*\[(?:native code|function)\]\s*\}/i;return exports.isType=function(e,t){return{}.toString.call(e).indexOf("[object "+t)>=0},exports.isNative=function(e){return!(!e||!t.test(e))},exports.instanceOf=function(e,t){return e&&e.hasOwnProperty&&e instanceof t},exports.extend=function(e,t){for(var i in t)if(t.hasOwnProperty(i)&&"_belong"!==i)e[i]=t[i];return e},exports.getBid=function(){var e,t=(+new Date).toString(),i=Math.floor(1e5*Math.random()).toString(),n=5-i.length;if(n>0)for(e=0;e<n;e++)i+="0";return t+i},exports.uuid=function(){for(var e=[],t="0123456789abcdef",i=0;i<36;i++)e[i]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},exports.parseTime=function(t,i){function n(e,t){i=i.replace(e,t)}if("string"!=typeof i)return t.toString();var o=t.getFullYear(),r=t.getMonth()+1,a=t.getDate(),s=t.getHours(),c=t.getMinutes(),u=t.getSeconds();return n(/yyyy/g,e(o,4)),n(/yy/g,e(parseInt(o.toString().slice(2),10),2)),n(/MM/g,e(r,2)),n(/M/g,r),n(/dd/g,e(a,2)),n(/d/g,a),n(/HH/g,e(s,2)),n(/H/g,s),n(/hh/g,e(s%12,2)),n(/h/g,s%12),n(/mm/g,e(c,2)),n(/m/g,c),n(/ss/g,e(u,2)),n(/s/g,u),i},exports.trim=function(e){var t=new RegExp("(^[\\s\\t\\xa0\\u3000]+)|([\\u3000\\xa0\\s\\t]+$)","g");return String(e).replace(t,"")},exports.transferDate=function(e){if(e=+e,isNaN(e))return e;var t=+new Date(e),i=["\u4eca\u5929","\u6628\u5929"],n=864e5,o=new Date,r=parseInt((+o-6e4*o.getTimezoneOffset())/n,10),a=r-parseInt((t-6e4*o.getTimezoneOffset())/n,10);if((a=Math.abs(a))<i.length)return i[a];else return exports.parseTime(new Date(e),"yyyy-MM-dd")},exports}),define("embed/log/main",["require","../../base/pc/lib"],function(require){function e(e){return!s[e]&&(s[e]="uuid_"+r.uuid()),s[e]}function t(){return!s.tabid&&(s.tabid="tabid_"+(new Date).getTime()),s.tabid}function i(e){return(new Date).getTime()-a[e]}function n(e,t){a[e]=t||+new Date}function o(e){var t=1,i=e.match(/(iPad).*OS\s([\d_]+)/),n=!i&&e.match(/(iPhone\sOS)\s([\d_]+)/),o=e.match(/(Android);?[\s\/]+([\d.]+)?/);if(i||n)t=3;else if(o)t=2;return t}var r=require("../../base/pc/lib"),exports={},a={},s={pushTotalMsg:0,pushFailMsg:0,pickMsg:0,pushMsg:0,ifLoopStart:!1},c={};exports.componentIsShow={icon:0,toolbar:0},exports.smartInvite={expGroup:"",text:"",isUse:0,ideaType:-1,staytimeabtest:"",query:-1,startObj:{}};var u=1,l=0,f=0,d=0,m=0,g=["m2005","m2021"];return exports.init=function(e,t,i){var n=e.getServer(),o=n.siteObj;a.eid=o.eid,a.siteid=o.siteId,a.platform=o.platform,i.bid=t.init(o.siteId,o.bid||i.bid,o.session),a.bid=i.bid,a.logRoot=e.staticDomain,a.startTime=n.startTime,exports.smartInvite.likeCrm=n.configBox.inviteBox.likeCrm,exports.smartInvite.inviteBox=n.configBox.inviteBox},exports.addLightMsg=function(e){if("sub"==(e.role?"sub":"custom"))s.pickMsg++;else s.pushMsg++,s.pushTotalMsg++},exports.sendFailMsg=function(){s.pushFailMsg++},exports.logQueue=function(){exports.sendLog(t(),{uuid:e("openUUID"),cncttype:"queue",brgeyemid:"m2007",winType:"webimLight",cost:c.render+i("m2013"),queueCost:i("m2013")})},exports.logConnect=function(){if(exports.sendLog(t(),{uuid:e("openUUID"),cncttype:"connected",brgeyemid:"m2007",winType:"webimLight",cost:c.render+i("m2013"),transferCost:i("m2013")}),!s.ifLoopStart)exports.logPickMsg(),exports.logPushMsg(),s.ifLoopStart=!0},exports.logTransferFail=function(){exports.sendLog(t(),{uuid:e("openUUID"),cncttype:"failed",brgeyemid:"m2007",winType:"webimLight",cost:c.render+i("m2013"),transferCost:i("m2013")})},exports.logOpenWebim=function(){exports.sendLog(t(),{cncttype:"openWebim",uuid:e("openUUID"),brgeyemid:"m2006"})},exports.logClickSeek=function(e,i,n,o){var r={brgeyemid:"m2005",url:document.URL,referrer:document.referrer,bclid:i.get("BCLID")};if(exports.smartInvite.isPcSmart&&"accept"===n&&o)if(+exports.smartInvite.smartButtonType){for(var a=!1,s=o.target.className.split(" "),c=0;c<s.length;c++)if("nb-invite-ok-show"===s[c])a=!0;if(a)d+=1,r.smartNthClickBtnInvite=d}else m+=1,r.smartNthClickBgInvite=m;n&&(r.type=n),exports.sendLog(t(),r)},exports.logPickMsg=function(){var e=function(){var e=s.pickMsg;if(s.pickMsg=0,e>0)exports.sendLog(t(),{num:e,brgeyemid:"m2004"});setTimeout(arguments.callee,5e3)};setTimeout(e,5e3)},exports.logPushMsg=function(){var e=function(){var e=s.pushMsg;if(s.pushMsg=0,e>0)exports.sendLog(t(),{num:e,brgeyemid:"m2003"});setTimeout(arguments.callee,5e3)};setTimeout(e,5e3)},exports.logEndNb=function(){exports.sendLog(t(),{uuid:e("nbUUID"),brgeyemid:"m2002"})},exports.logStartNb=function(){exports.sendLog(t(),{uuid:e("nbUUID"),brgeyemid:"m2001"})},exports.logRenderStart=function(){n("m2008",a.startTime),exports.sendLog(t(),{uuid:e("renderUUID"),brgeyemid:"m2008"})},exports.logRenderEnd=function(){c.render=i("m2008"),exports.sendLog(t(),{cncttype:"renderFinish",uuid:e("renderUUID"),brgeyemid:"m2009",cost:c.render,icon:exports.componentIsShow.icon,toolbar:exports.componentIsShow.toolbar})},exports.logEnterStart=function(){n("m2010"),exports.sendLog(t(),{cncttype:"startSite",uuid:e("enterUUID"),brgeyemid:"m2010"})},exports.logEnterEnd=function(){exports.sendLog(t(),{cncttype:"finishSite",uuid:e("enterUUID"),brgeyemid:"m2011",cost:i("m2008"),siteCost:i("m2010")})},exports.logStartTransfer=function(){n("m2013")},exports.leaveSite=function(){exports.sendLog(t(),{uuid:e("enterUUID"),brgeyemid:"m2012",totalMsgCount:s.pushTotalMsg,failMsgCount:s.pushFailMsg}),exports.sendLog(t(),{uuid:e("msgFailRate"),brgeyemid:"m2014",totalMsgCount:s.pushTotalMsg,failMsgCount:s.pushFailMsg})},exports.logForceTalk=function(){exports.sendLog(t(),{cncttype:"forceTalk",uuid:e("openUUID"),brgeyemid:"m2015"})},exports.logClickUnread=function(){exports.sendLog(t(),{cncttype:"clickUnread",uuid:e("openUUID"),brgeyemid:"m2015"})},exports.logClickMsgLite=function(){exports.sendLog(t(),{cncttype:"clickMsgLite",uuid:e("openUUID"),brgeyemid:"m2015"})},exports.logClickOnlineConsult=function(){exports.sendLog(t(),{cncttype:"clickOnlineConsult",uuid:e("openUUID"),brgeyemid:"m2016"})},exports.logClickDial=function(){exports.sendLog(t(),{cncttype:"clickDial",uuid:e("openUUID"),brgeyemid:"m2016"})},exports.logClickGetConnect=function(){exports.sendLog(t(),{cncttype:"clickGetConnect",uuid:e("openUUID"),brgeyemid:"m2016"})},exports.logMessageAutoShow=function(i){exports.sendLog(t(),{cncttype:"messageAutoShow",uuid:e("openUUID"),brgeyemid:"m2017",url:document.URL,referrer:document.referrer,bclid:i.get("BCLID")})},exports.logMessageClickShow=function(i){exports.sendLog(t(),{cncttype:"messageClickShow",uuid:e("openUUID"),brgeyemid:"m2017",url:document.URL,referrer:document.referrer,bclid:i.get("BCLID")})},exports.logInviteShow=function(i,n){if(1===u){if(0!==exports.smartInvite.likeCrm)u=0;l+=1;var r={cncttype:"inviteShow",uuid:e("openUUID"),brgeyemid:"m2018",isSmart:i,text:exports.smartInvite.text,from:n,nthShowInvite:l};if(1==+l&&1!=+o(navigator.userAgent))if(2==+n)r.lkstaytimeabtest=0;else r.lkstaytimeabtest=exports.smartInvite.staytimeabtest;exports.sendLog(t(),r)}},exports.logMsgBubbleShow=function(){exports.sendLog(t(),{cncttype:"msgBubbleShow",uuid:e("openUUID"),brgeyemid:"m2019"})},exports.logClickIcon=function(){exports.sendLog(t(),{cncttype:"clickIcon",uuid:e("openUUID"),brgeyemid:"m2020"})},exports.logClickInvite=function(i){f+=1;var n={cncttype:"clickInvite",uuid:e("openUUID"),brgeyemid:"m2021",from:i,text:exports.smartInvite.text};if(1==+f&&1!=+o(navigator.userAgent))if(2==+i)n.lkstaytimeabtest=0;else n.lkstaytimeabtest=exports.smartInvite.staytimeabtest;exports.sendLog(t(),n)},exports.logClickMsgBubble=function(){exports.sendLog(t(),{cncttype:"clickMsgBubble",uuid:e("openUUID"),brgeyemid:"m2023"})},exports.logClickSmartLogo=function(){exports.sendLog(t(),{cncttype:"clickSmartLogo",uuid:e("openUUID"),brgeyemid:"m4001"})},exports.logCloseSmartInvite=function(){exports.sendLog(t(),{cncttype:"closeSmartInvite",uuid:e("openUUID"),brgeyemid:"m4002"})},exports.logStopSmartInvite=function(i){exports.sendLog(t(),{cncttype:"stopSmartInvite",uuid:e("openUUID"),brgeyemid:"m4003",stopSmartInviteType:i})},exports.sendLog=function(e,t,i,n,r,s){var c=s||{};if(c.t=(new Date).getTime(),c.ip="",c.dtype=o(navigator.userAgent),c.ucid=i.eid||a.eid,c.uid=t.get("to")||i.tid||"",c.siteid=i.siteid||a.siteid,c.tabid=r,c.bid=i.bid||a.bid,c.sessionid=t.get("sid")||i.sid||"",c.originType=0,exports.smartInvite.expGroup)c.siExpGroup=exports.smartInvite.expGroup,c.welcome=exports.smartInvite.text;if(c.likeCrm=exports.smartInvite.likeCrm,exports.smartInvite.isPcSmart=1==+c.dtype&&1==+n.isUseSmartyInvite&&1==+n.isHasSmartAccess&&19==+exports.smartInvite.inviteBox.tradeId&&0==+exports.smartInvite.inviteBox.likeCrm&&exports.smartInvite.inviteBox.smartBaseSetting&&1==+exports.smartInvite.inviteBox.smartBaseSetting.isCustomerStyle,exports.smartInvite.isPcSmart)exports.smartInvite.smartButtonType=exports.smartInvite.inviteBox.smartBaseSetting.buttonType;if(exports.smartInvite.isPcSmart)if(c.smartButtonType=exports.smartInvite.smartButtonType,exports.smartInvite.imgTextResponse)c.isHasSmartImgText=exports.smartInvite.isHasSmartImgText,c.isHitSmartImgText=exports.smartInvite.isHitSmartImgText||0,c.isHasSmartBackImg=exports.smartInvite.isHasSmartBackImg||0;c.ideaType=exports.smartInvite.ideaType,c.query=exports.smartInvite.query;for(var u in exports.smartInvite.startObj)if(exports.smartInvite.startObj.hasOwnProperty(u))if("type"!==u&&"query"!==u)c[u]=exports.smartInvite.query[u];if(s&&s.brgeyemid&&-1!==g.indexOf(s.brgeyemid))c.from=i.fromType;e.send(a.logRoot,c)},exports}),define("embed/log/mobileConfig",["require","./main"],function(require){return{package:"log",resource:{main:require("./main")},injection:[{id:"log.main",method:{init:["data.config","mchat.bid","core.config"],sendLog:["core.log","core.chat","core.config"],logClickSeek:["core.main","common.cookie"]}}],aspect:[{id:"log.main",pointCut:["micon.main.init, logRenderStart, ","icon.handle.acceptClick, ,logClickSeek","invite.operation.clickInvite, ,logClickSeek","minvite.main.init, , logRenderEnd","mchat.chat.builtComunicate, logEnterStart, ","mchat.chat.enterSuccess, ,logEnterEnd","mchat.leave.pageLeave, , leaveSite","micon.phandler.clickIcon, ,logClickSeek","minvite.mhandler.acceptInvite, ,logClickSeek","toolbar.main.clickOnlineConsult, ,logClickOnlineConsult","toolbar.main.clickDial, ,logClickDial","toolbar.main.clickGetConnect, ,logClickGetConnect"]}]}}),define("embed/toolbar/toolbarMain",["require"],function(require){function e(e){for(var t=[],i=0;i<e.length;i++)if(1===e[i].enable)t.push(e[i].type);return t.join("_")}var exports={},t="nb_toolbar_",i={ONLINECONSULT:"onlineConsult",DIAL:"dial",GETCONNECT:"getConnect"},n=/^((http|https|ftp|\/\/):)/;return exports.updateOrientation=function(e){var t=window.innerWidth>window.innerHeight?"landscape":"portrait",i=e.g("nb_toolbar_wrap");if("portrait"===t)e.removeClass(i,"qiao-toolbar-horizontal"),e.addClass(i,"qiao-toolbar-vertical");else e.removeClass(i,"qiao-toolbar-vertical"),e.addClass(i,"qiao-toolbar-horizontal")},exports.dataProcess=function(e,t){for(var o=e.getServer("configBox").toolbar,r=0,a=0,s=0,c=o.iconOrder.length;s<c;s++){var u=o.iconOrder[s];if(0!==u.enable){switch(u.type){case i.ONLINECONSULT:u.href="javascript:void(0)";break;case i.DIAL:u.href="tel:"+u.phoneNumber;break;case i.GETCONNECT:if(!n.test(u.connectUrl))u.connectUrl="//"+u.connectUrl;u.href=u.connectUrl,u.target="_blank"}r++,a=s,u.last=""}}return o.wrapClass="qiao-toolbar-btn-"+["one","two","three"][r-1],o.iconOrder[a].last="qiao-toolbar-btn-last",o.bgColorPre="rgba("+t.hexToRgb(o.bgColor,!0).join(",")+","+o.opacity/100+")",o},exports.renderHtml=function(t,i,n,o,r){var a=exports.dataProcess(),s=t.template(i,a);n.appendHTML(s,o.getWrap()),r.componentIsShow.toolbar=e(a.iconOrder),exports.updateOrientation()},exports.clickOnlineConsult=function(e,t){e.accept(0),t.hide(["nb_invite_wrap"])},exports.clickDial=function(){},exports.clickGetConnect=function(){},exports.bindEvents=function(e,n){window.addEventListener("resize",exports.updateOrientation,!1),n.domOn(t+i.ONLINECONSULT,"click",exports.clickOnlineConsult,!1),n.domOn(t+i.DIAL,"click",exports.clickDial,!1),n.domOn(t+i.GETCONNECT,"click",exports.clickGetConnect,!1)},exports.init=function(e){var t=e.getServer("configBox").toolbar;if(0!=+(void 0===t?0:t.enable))exports.renderHtml(),exports.bindEvents()},exports}),define("embed/toolbar/toolbar.tpl",[],function(){return'\x3c!-- target: toolbar --\x3e<ins id="nb_toolbar_wrap" class="qiao-toolbar-wrapper <%wrapClass%>" style="height:<%height%>%;background:<%bgColorPre%>;bottom:<%bottomDistance%>%;"><% for (var i = 0, l = data.iconOrder.length; i < l; i++) { %><% if (data.iconOrder[i].enable == 1) { %><a id="nb_toolbar_<%iconOrder[i].type%>" class="<%iconOrder[i].last%>" href="<%iconOrder[i].href%>"<% if (data.iconOrder[i].target) { %>target="<%iconOrder[i].target%>"<% }%>style="background:<%iconOrder[i].btnColor%>;color:<%iconOrder[i].btnTxtColor%>;"><%iconOrder[i].btnTxt%></a><% } %><% } %></ins>'}),define("embed/toolbar/toolbarConfig",["require","./toolbarMain","./toolbar.tpl"],function(require){return{package:"toolbar",resource:{main:require("./toolbarMain"),tpl:require("./toolbar.tpl")},injection:[{id:"toolbar.main",method:{init:["data.config"],renderHtml:["common.util","toolbar.tpl","mbase.dom","common.view","log.main"],bindEvents:["mbase.dom","mbase.events"],dataProcess:["data.config","mbase.lib"],updateOrientation:["mbase.dom"],clickOnlineConsult:["mchat.chat","mbase.dom"]}}]}}),define("embed/entry/mobile/mobileConfig",["require","im-core/bullConfig","im-lib/config","../../../base/baseMobileConfig","../../../common/mobileConfig","../../data/bullConfig","../../embedChat/mConfig","../../invite/inviteMConfig","../../icon/iconMConfig","../../log/mobileConfig","../../toolbar/toolbarConfig"],function(require){return{package:"membed",importConfig:[require("im-core/bullConfig"),require("im-lib/config"),require("../../../base/baseMobileConfig"),require("../../../common/mobileConfig"),require("../../data/bullConfig"),require("../../embedChat/mConfig"),require("../../invite/inviteMConfig"),require("../../icon/iconMConfig"),require("../../log/mobileConfig"),require("../../toolbar/toolbarConfig")]}}),define("embed/entry/mobile/mobileHack",["require","common/view","base/mobile/dom"],function(require){var e=require("common/view"),t=require("base/mobile/dom"),exports={};return exports.init=function(){this.regex={initScale:/initial\-scale/},this.check()},exports.check=function(){var i=this,n=e.getWrap(),o=document.querySelectorAll('meta[name="viewport"]');o=[].slice.call(o);var r=!1;if(o.some(function(e){if(e.getAttribute("content").match(i.regex.initScale))return r=!0,!0}),!r)t.setStyle(n,"mobile-no-scale")},exports}),define("base/pc/brower",[],function(){var e,t=document,i=new RegExp("msie (\\d+\\.\\d+)|trident","i");return{ie:function(){return i.test(navigator.userAgent)?t.documentMode||+RegExp.$1:e}(),isBDBox:/ baiduboxapp\//i.test(navigator.userAgent),opera:/opera(\/| )(\d+(\.\d+)?)(.+?(version\/(\d+(\.\d+)?)))?/i.test(navigator.userAgent)?+(RegExp.$6||RegExp.$2):void 0,isStrict:function(){return"CSS1Compat"===t.compatMode},isMobile:function(){return!!navigator.userAgent.match(/.*Mobile.*/)||"ontouchstart"in window}()}}),define("cl",["require","./base/pc/brower"],function(require){var exports={},e=require("./base/pc/brower");return exports.load=function(t,i,n,o){var r=document.createElement("link");if(r.setAttribute("rel","stylesheet"),r.setAttribute("type","text/css"),r.setAttribute("href",i.toUrl(t)),("object"==typeof r.onload||"object"==typeof r.onreadystatechange)&&!e.isBDBox){var a=!1;r.onload=function(){r.onreadystatechange=null,r.onload=null,n(!0),a=!0},r.onreadystatechange=function(){if(/^loaded|complete$/.test(this.readyState))this.onreadystatechange=null,r.onload=null,n(!0),a=!0},setTimeout(function(){if(!a)n(!0)},3e3)}else n(!0);(document.getElementsByTagName("head")[0]||document.body).appendChild(r)},exports}),define("lib/css",["cl"],function(e){return e}),define("common/css",["cl"],function(e){return e}),define("embed/entry/mobile/main",["require","bull","./mobileConfig","./mobileHack","cl!../../css/mobile/main.css","../../../base/mobile/event"],function(require){var exports={},e=require("bull"),t=require("./mobileConfig"),i=require("./mobileHack");return exports.init=function(){require("cl!../../css/mobile/main.css"),e.init(t),e.get("log.main").init(),this.bindEvent(),e.get("toolbar.main").init(),this.handle(),(0,(false||document.getElementById("newBridge")).require)(["embed/mobilelite/main"],function(e){})},exports.bindEvent=function(){function e(e){e.stopPropagation()}var t=require("../../../base/mobile/event"),i="newBridge";t.domOn(i,"touchsatart",e),t.domOn(i,"touchmove",e),t.domOn(i,"touchend",e)},exports.handle=function(){i.init()},exports}),require(["embed/entry/mobile/main"],function(n){document.getElementById("newBridge").deferOnce.on(n.init.bind(n))})}();
